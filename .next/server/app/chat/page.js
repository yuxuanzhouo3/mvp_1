(()=>{var e={};e.id=1929,e.ids=[1929],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},10941:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>u,tree:()=>o});var r=s(67096),a=s(16132),i=s(37284),l=s.n(i),n=s(32564),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);s.d(t,c);let o=["",{children:["chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,50431)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/chat/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,3102)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/layout.tsx"],error:[()=>Promise.resolve().then(s.bind(s,38196)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/error.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,44293)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/not-found.tsx"]}],d=["/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/chat/page.tsx"],x="/chat/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/chat/page",pathname:"/chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},57743:(e,t,s)=>{Promise.resolve().then(s.bind(s,94641))},94641:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var r=s(53854),a=s(34218),i=s(51018),l=s(86665),n=s(31974),c=s(42833),o=s(2882),d=s(10518),x=s(88640),m=s(49425),u=s(67510),h=s(85096);function p(){let{user:e,signOut:t,loading:s}=(0,l.a)(),p=(0,i.useRouter)(),{toast:g}=(0,n.p)(),[y,b]=(0,a.useState)([]),[f,v]=(0,a.useState)(!0),[j,N]=(0,a.useState)(!1),w=(0,c.eI)("https://bamratexknmqvdbalzen.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJhbXJhdGV4a25tcXZkYmFsemVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MTM4NzEsImV4cCI6MjA2ODA4OTg3MX0.yYa98ioJLLouUgHWITGb7U_VjNCTUuM-5NcraM7f3zA"),_=async()=>{if(e?.id)try{v(!0);let{data:{session:e}}=await w.auth.getSession(),t=e?.access_token;if(!t)return;let s={Authorization:`Bearer ${t}`,"Content-Type":"application/json"},r=await fetch("/api/chat/list",{headers:s});if(r.ok){let e=await r.json();b(e.chats||[])}else g({title:"加载失败",description:"无法加载聊天列表",variant:"destructive"})}catch(e){g({title:"加载失败",description:"网络错误，请稍后重试",variant:"destructive"})}finally{v(!1)}};(0,a.useEffect)(()=>{if(!s){if(!e||!e.id){p.push("/auth/login");return}_()}},[e,s]);let k=async()=>{try{await t(),window.location.href="/auth/login",g({title:"已退出登录",description:"期待您的再次光临！"})}catch(e){g({title:"退出失败",description:"请稍后重试",variant:"destructive"})}};return f||s?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"加载中..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("header",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,r.jsxs)("button",{onClick:()=>p.push("/dashboard"),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",children:[r.jsx(o.Z,{className:"h-5 w-5 mr-2"}),"返回"]}),r.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"聊天"}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium",children:e?.user_metadata?.full_name?.charAt(0).toUpperCase()||"U"}),r.jsx("span",{className:"text-sm font-medium text-gray-700 hidden sm:block",children:e?.user_metadata?.full_name||"User"})]}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx("button",{className:"flex items-center space-x-1 text-gray-600 hover:text-gray-900 transition-colors",children:r.jsx(d.Z,{className:"h-4 w-4"})}),(0,r.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10 hidden group-hover:block",children:[r.jsx("button",{onClick:()=>p.push("/dashboard/settings"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"设置"}),r.jsx("hr",{className:"my-1"}),r.jsx("button",{onClick:k,className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100",children:"退出登录"})]})]})]})]})})}),(0,r.jsxs)("div",{className:`fixed inset-y-0 left-0 z-40 w-64 bg-white shadow-lg transform transition-transform duration-300 ease-in-out ${j?"translate-x-0":"-translate-x-full"}`,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"PersonaLink"}),r.jsx("button",{onClick:()=>N(!1),className:"text-gray-500 hover:text-gray-700",children:r.jsx(o.Z,{className:"h-5 w-5"})})]}),r.jsx("nav",{className:"mt-4",children:(0,r.jsxs)("div",{className:"px-4 space-y-2",children:[(0,r.jsxs)("button",{onClick:()=>{p.push("/dashboard"),N(!1)},className:"w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 hover:text-gray-900",children:[r.jsx(x.Z,{className:"mr-3 h-5 w-5"}),"首页"]}),(0,r.jsxs)("button",{onClick:()=>{p.push("/chat"),N(!1)},className:"w-full flex items-center px-3 py-2 text-sm font-medium text-blue-600 rounded-md bg-blue-50",children:[r.jsx(m.Z,{className:"mr-3 h-5 w-5"}),"聊天"]}),(0,r.jsxs)("button",{onClick:()=>{p.push("/matching"),N(!1)},className:"w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 hover:text-gray-900",children:[r.jsx(u.Z,{className:"mr-3 h-5 w-5"}),"匹配"]}),(0,r.jsxs)("button",{onClick:()=>{p.push("/payment/recharge"),N(!1)},className:"w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 hover:text-gray-900",children:[r.jsx(h.Z,{className:"mr-3 h-5 w-5"}),"充值"]}),(0,r.jsxs)("button",{onClick:()=>{p.push("/dashboard/settings"),N(!1)},className:"w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 hover:text-gray-900",children:[r.jsx(d.Z,{className:"mr-3 h-5 w-5"}),"设置"]})]})})]}),j&&r.jsx("div",{className:"fixed inset-0 z-30 bg-black bg-opacity-50",onClick:()=>N(!1)}),r.jsx("div",{className:"pt-16",children:r.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:0===y.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx(m.Z,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"还没有聊天"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"开始匹配来找到新的朋友吧！"}),r.jsx("button",{onClick:()=>p.push("/matching"),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"开始匹配"})]}):(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"聊天列表"})}),r.jsx("div",{className:"divide-y divide-gray-200",children:y.map(e=>r.jsx("div",{onClick:()=>p.push(`/chat/${e.id}`),className:"px-6 py-4 hover:bg-gray-50 cursor-pointer transition-colors",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-12 h-12 bg-gray-600 rounded-full flex items-center justify-center text-white font-semibold",children:e.matched_user.full_name?.charAt(0).toUpperCase()}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:e.matched_user.full_name}),e.last_message&&r.jsx("p",{className:"text-sm text-gray-600 truncate max-w-xs",children:e.last_message.content})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[e.last_message&&r.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.last_message.created_at).toLocaleDateString()}),e.unread_count>0&&r.jsx("div",{className:"mt-1",children:r.jsx("span",{className:"inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-red-600 rounded-full",children:e.unread_count})})]})]})},e.id))})]})})})]})}},31974:(e,t,s)=>{"use strict";s.d(t,{p:()=>a});var r=s(70664);let a=r.pm},2882:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},85096:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},49425:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},50431:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>i,default:()=>c});var r=s(95153);let a=(0,r.createProxy)(String.raw`/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/chat/page.tsx`),{__esModule:i,$$typeof:l}=a,n=a.default,c=n}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[3271,5359,7583],()=>s(10941));module.exports=r})();