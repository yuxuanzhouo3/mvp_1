(()=>{var e={};e.id=1929,e.ids=[1929],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},10941:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>o,routeModule:()=>m,tree:()=>d});var r=s(67096),a=s(16132),i=s(37284),l=s.n(i),n=s(32564),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);s.d(t,c);let d=["",{children:["chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,50431)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/chat/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,62111)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/layout.tsx"],error:[()=>Promise.resolve().then(s.bind(s,38196)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/error.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,44293)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/not-found.tsx"]}],o=["/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/chat/page.tsx"],u="/chat/page",x={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/chat/page",pathname:"/chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},57743:(e,t,s)=>{Promise.resolve().then(s.bind(s,94641))},94641:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var r=s(53854),a=s(34218),i=s(51018),l=s(86665),n=s(63165),c=s(7857),d=s(24769),o=s(39195),u=s(26115),x=s(31974),m=s(14024),h=s(24234),p=s(49425),f=s(67510),g=s(86974),v=s(72024),j=s(88745);function y(){let e=(0,i.useRouter)(),{user:t}=(0,l.a)(),{toast:s}=(0,x.p)(),[y,b]=(0,a.useState)([]),[N,w]=(0,a.useState)([]),[_,k]=(0,a.useState)(""),[q,S]=(0,a.useState)(!0),[C,E]=(0,a.useState)("all");(0,a.useEffect)(()=>{if(!t){e.push("/auth/login");return}Z()},[t]),(0,a.useEffect)(()=>{z()},[y,_,C]);let Z=async()=>{try{S(!0);let e=await fetch("/api/chat/list");if(e.ok){let t=await e.json();b(t.chats)}}catch(e){s({title:"加载失败",description:"无法加载聊天列表",variant:"destructive"})}finally{S(!1)}},z=()=>{let e=y;switch(_&&(e=e.filter(e=>e.matched_user.full_name.toLowerCase().includes(_.toLowerCase()))),C){case"unread":e=e.filter(e=>e.unread_count>0);break;case"online":e=e.filter(e=>e.matched_user.is_online)}w(e)},P=t=>{e.push(`/chat/${t}`)},D=()=>{e.push("/matching")},L=e=>"image"===e.message_type?"\uD83D\uDCF7 图片":"file"===e.message_type?"\uD83D\uDCCE 文件":e.content.length>30?e.content.substring(0,30)+"...":e.content,M=e=>{let t=new Date(e),s=new Date,r=(s.getTime()-t.getTime())/36e5;return r<1?"刚刚":r<24?`${Math.floor(r)}小时前`:t.toLocaleDateString("zh-CN")};return q?r.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"加载聊天列表中..."})]})}):r.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"聊天"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"与您的匹配对象保持联系"})]}),(0,r.jsxs)(c.z,{onClick:D,children:[r.jsx(m.Z,{className:"h-4 w-4 mr-2"}),"开始匹配"]})]}),(0,r.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,r.jsxs)("div",{className:"relative",children:[r.jsx(h.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),r.jsx(d.I,{placeholder:"搜索聊天...",value:_,onChange:e=>k(e.target.value),className:"pl-10"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx(c.z,{variant:"all"===C?"default":"outline",size:"sm",onClick:()=>E("all"),children:"全部"}),r.jsx(c.z,{variant:"unread"===C?"default":"outline",size:"sm",onClick:()=>E("unread"),children:"未读"}),r.jsx(c.z,{variant:"online"===C?"default":"outline",size:"sm",onClick:()=>E("online"),children:"在线"})]})]}),0===N.length?r.jsx(n.Zb,{children:(0,r.jsxs)(n.aY,{className:"text-center py-12",children:[r.jsx(p.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:_?"没有找到匹配的聊天":"还没有聊天"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:_?"尝试调整搜索条件":"开始匹配来找到新的朋友并开始聊天"}),!_&&(0,r.jsxs)(c.z,{onClick:D,children:[r.jsx(f.Z,{className:"h-4 w-4 mr-2"}),"开始匹配"]})]})}):r.jsx("div",{className:"space-y-4",children:N.map(e=>r.jsx(n.Zb,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>P(e.id),children:r.jsx(n.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)(o.qE,{className:"h-12 w-12",children:[r.jsx(o.F$,{src:e.matched_user.avatar_url}),r.jsx(o.Q5,{children:e.matched_user.full_name?.charAt(0).toUpperCase()})]}),r.jsx("div",{className:`absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white dark:border-gray-800 ${e.matched_user.is_online?"bg-green-500":"bg-gray-400"}`})]}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.matched_user.full_name}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)(u.C,{variant:"secondary",className:"text-xs",children:[Math.round(100*e.compatibility_score),"% 匹配"]}),r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:M(e.last_message.created_at)})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:L(e.last_message)}),e.unread_count>0&&r.jsx(u.C,{variant:"destructive",className:"text-xs",children:e.unread_count})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[r.jsx(c.z,{variant:"ghost",size:"sm",children:r.jsx(g.Z,{className:"h-4 w-4"})}),r.jsx(c.z,{variant:"ghost",size:"sm",children:r.jsx(v.Z,{className:"h-4 w-4"})}),r.jsx(c.z,{variant:"ghost",size:"sm",children:r.jsx(j.Z,{className:"h-4 w-4"})})]})]})})},e.id))}),y.length>0&&r.jsx("div",{className:"mt-8",children:r.jsx(n.Zb,{children:r.jsx(n.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-600 dark:text-gray-400",children:[(0,r.jsxs)("span",{children:["总计 ",y.length," 个聊天"]}),(0,r.jsxs)("span",{children:[y.filter(e=>e.unread_count>0).length," 个未读"]}),(0,r.jsxs)("span",{children:[y.filter(e=>e.matched_user.is_online).length," 个在线"]})]})})})})]})})}},39195:(e,t,s)=>{"use strict";s.d(t,{F$:()=>c,Q5:()=>d,qE:()=>n});var r=s(53854),a=s(34218),i=s(49198),l=s(56370);let n=a.forwardRef(({className:e,...t},s)=>r.jsx(i.fC,{ref:s,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));n.displayName=i.fC.displayName;let c=a.forwardRef(({className:e,...t},s)=>r.jsx(i.Ee,{ref:s,className:(0,l.cn)("aspect-square h-full w-full",e),...t}));c.displayName=i.Ee.displayName;let d=a.forwardRef(({className:e,...t},s)=>r.jsx(i.NY,{ref:s,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));d.displayName=i.NY.displayName},24769:(e,t,s)=>{"use strict";s.d(t,{I:()=>l});var r=s(53854),a=s(34218),i=s(56370);let l=a.forwardRef(({className:e,type:t,label:s,error:a,icon:l,description:n,...c},d)=>(0,r.jsxs)("div",{className:"w-full space-y-1",children:[s&&r.jsx("label",{className:"block text-sm font-medium text-foreground",children:s}),(0,r.jsxs)("div",{className:"relative",children:[l&&r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:l}),r.jsx("input",{type:t,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background","file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50",l?"pl-10":"",a?"border-destructive focus-visible:ring-destructive/30":"",e),ref:d,...c})]}),n&&!a&&r.jsx("p",{className:"text-xs text-muted-foreground",children:n}),a&&r.jsx("p",{className:"text-xs text-destructive",children:a})]}));l.displayName="Input"},31974:(e,t,s)=>{"use strict";s.d(t,{p:()=>a});var r=s(70664);let a=r.pm},49425:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},88745:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},86974:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},14024:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},24234:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},72024:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]])},42380:(e,t,s)=>{"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=s(34218);"function"==typeof Object.is&&Object.is,r.useState,r.useEffect,r.useLayoutEffect,r.useDebugValue,t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:function(e,t){return t()}},41913:(e,t,s)=>{"use strict";e.exports=s(42380)},50431:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>i,default:()=>c});var r=s(95153);let a=(0,r.createProxy)(String.raw`/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/chat/page.tsx`),{__esModule:i,$$typeof:l}=a,n=a.default,c=n},49198:(e,t,s)=>{"use strict";s.d(t,{NY:()=>w,Ee:()=>Image,fC:()=>N});var r=s(34218),a=s(65864),i=s(64928),l=s(76223),n=s(59280),c=s(41913);function d(){return()=>{}}var o=s(53854),u="Avatar",[x,m]=(0,a.b)(u),[h,p]=x(u),f=r.forwardRef((e,t)=>{let{__scopeAvatar:s,...a}=e,[i,l]=r.useState("idle");return(0,o.jsx)(h,{scope:s,imageLoadingStatus:i,onImageLoadingStatusChange:l,children:(0,o.jsx)(n.WV.span,{...a,ref:t})})});f.displayName=u;var g="AvatarImage",v=r.forwardRef((e,t)=>{let{__scopeAvatar:s,src:a,onLoadingStatusChange:u=()=>{},...x}=e,m=p(g,s),h=function(e,{referrerPolicy:t,crossOrigin:s}){let a=(0,c.useSyncExternalStore)(d,()=>!0,()=>!1),i=r.useRef(null),n=a?(i.current||(i.current=new window.Image),i.current):null,[o,u]=r.useState(()=>b(n,e));return(0,l.b)(()=>{u(b(n,e))},[n,e]),(0,l.b)(()=>{let e=e=>()=>{u(e)};if(!n)return;let r=e("loaded"),a=e("error");return n.addEventListener("load",r),n.addEventListener("error",a),t&&(n.referrerPolicy=t),"string"==typeof s&&(n.crossOrigin=s),()=>{n.removeEventListener("load",r),n.removeEventListener("error",a)}},[n,s,t]),o}(a,x),f=(0,i.W)(e=>{u(e),m.onImageLoadingStatusChange(e)});return(0,l.b)(()=>{"idle"!==h&&f(h)},[h,f]),"loaded"===h?(0,o.jsx)(n.WV.img,{...x,ref:t,src:a}):null});v.displayName=g;var j="AvatarFallback",y=r.forwardRef((e,t)=>{let{__scopeAvatar:s,delayMs:a,...i}=e,l=p(j,s),[c,d]=r.useState(void 0===a);return r.useEffect(()=>{if(void 0!==a){let e=window.setTimeout(()=>d(!0),a);return()=>window.clearTimeout(e)}},[a]),c&&"loaded"!==l.imageLoadingStatus?(0,o.jsx)(n.WV.span,{...i,ref:t}):null});function b(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}y.displayName=j;var N=f,Image=v,w=y}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[3271,7085,7149],()=>s(10941));module.exports=r})();