(()=>{var e={};e.id=1191,e.ids=[1191],e.modules={30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},32081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},82899:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>v,patchFetch:()=>j,requestAsyncStorage:()=>y,routeModule:()=>_,serverHooks:()=>q,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>x});var s={};r.r(s),r.d(s,{POST:()=>m,PUT:()=>l});var i=r(10884),a=r(16132),n=r(21040),o=r(95798),u=r(78888),p=r(16163);let c=new u.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2023-10-16"}),d=(0,p.eI)("https://bamratexknmqvdbalzen.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function m(e){try{let{amount:t,currency:r="usd",paymentMethod:s,userId:i}=await e.json();if(!t||!i)return o.Z.json({error:"Amount and userId are required"},{status:400});let a=Math.floor(10*t),n=await c.paymentIntents.create({amount:Math.round(100*t),currency:r,payment_method_types:["card"],metadata:{userId:i,creditsPurchased:a.toString()}}),{error:u}=await d.from("transactions").insert({user_id:i,amount:t,currency:r,payment_method:"stripe",status:"pending",stripe_payment_intent_id:n.id,credits_purchased:a});if(u)return o.Z.json({error:"Failed to store transaction"},{status:500});return o.Z.json({clientSecret:n.client_secret,paymentIntentId:n.id,creditsPurchased:a})}catch(e){return o.Z.json({error:"Payment processing failed"},{status:500})}}async function l(e){try{let{paymentIntentId:t,status:r}=await e.json();if(!t||!r)return o.Z.json({error:"PaymentIntentId and status are required"},{status:400});let{error:s}=await d.from("transactions").update({status:r}).eq("stripe_payment_intent_id",t);if(s)return o.Z.json({error:"Failed to update transaction"},{status:500});if("succeeded"===r){let{data:e}=await d.from("transactions").select("user_id, credits_purchased").eq("stripe_payment_intent_id",t).single();if(e){let{error:t}=await d.from("profiles").update({credits:d.rpc("increment_credits",{user_id:e.user_id,credits_to_add:e.credits_purchased})}).eq("id",e.user_id)}}return o.Z.json({success:!0})}catch(e){return o.Z.json({error:"Failed to update payment"},{status:500})}}let _=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/payments/stripe/route",pathname:"/api/payments/stripe",filename:"route",bundlePath:"app/api/payments/stripe/route"},resolvedPagePath:"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/api/payments/stripe/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:h,serverHooks:q,headerHooks:f,staticGenerationBailout:x}=_,v="/api/payments/stripe/route";function j(){return(0,n.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[3271,1945,8107,8888],()=>r(82899));module.exports=s})();