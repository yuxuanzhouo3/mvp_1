(()=>{var e={};e.id=5427,e.ids=[5427,8181],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},38100:(e,t,a)=>{"use strict";a.r(t),a.d(t,{headerHooks:()=>f,originalPathname:()=>w,patchFetch:()=>_,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>h});var r={};a.r(r),a.d(r,{POST:()=>d});var s=a(10884),i=a(16132),n=a(21040),o=a(95798),u=a(69978),c=a(92813);async function d(e){try{let t=(0,u.e)(),{data:{user:a},error:r}=await t.auth.getUser();if(r||!a)return o.Z.json({error:"Unauthorized"},{status:401});let s=await e.json(),{paymentId:i,paymentMethod:n,transactionHash:d,transactionId:p,amount:l,fromAddress:m}=s;if(!i||!n||!l)return o.Z.json({error:"Missing required fields"},{status:400});let{data:y,error:f}=await t.from("payments").select("*").eq("id",i).eq("user_id",a.id).single();if(f||!y)return o.Z.json({error:"Payment not found"},{status:404});let h=!1;switch(n){case"usdt":if(!d||!m)return o.Z.json({error:"Missing transaction hash or from address for USDT payment"},{status:400});h=await (0,c.iJ)(i,d,l,m);break;case"alipay":if(!p)return o.Z.json({error:"Missing transaction ID for Alipay payment"},{status:400});h=await (0,c.Ve)(i,p,l);break;default:return o.Z.json({error:"Unsupported payment method"},{status:400})}if(h)return o.Z.json({success:!0,message:"Payment verified successfully",paymentId:i});return o.Z.json({error:"Payment verification failed"},{status:400})}catch(e){return o.Z.json({error:"Internal server error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/payments/verify-manual/route",pathname:"/api/payments/verify-manual",filename:"route",bundlePath:"app/api/payments/verify-manual/route"},resolvedPagePath:"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/api/payments/verify-manual/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:y,headerHooks:f,staticGenerationBailout:h}=p,w="/api/payments/verify-manual/route";function _(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},92813:(e,t,a)=>{"use strict";a.d(t,{VA:()=>d,eo:()=>c,Ve:()=>l,iJ:()=>p});var r=a(69978);let s={usdtWallets:[{id:"trc20-main",address:"TQn9Y2khDD95J42FQtQTdwVVRKqyqjqjqj",network:"TRC20",label:"Main USDT Wallet (TRC20)",isActive:!0},{id:"erc20-main",address:"0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b8",network:"ERC20",label:"Main USDT Wallet (ERC20)",isActive:!0}],paymentReceivers:[{id:"alipay-main",type:"alipay",name:"支付宝收款",account:"your-alipay-account@example.com",isActive:!0},{id:"wechat-main",type:"wechat",name:"微信收款",account:"your-wechat-id",isActive:!0}],settings:{minAmount:1,maxAmount:1e4,paymentTimeout:30,autoRefundAfter:24,supportedCurrencies:["CNY","USD","EUR"],defaultCurrency:"CNY"},webhooks:{stripe:"https://your-domain.com/api/payments/webhook",alipay:"https://your-domain.com/api/payments/alipay-webhook"},apiKeys:{stripe:{publishableKey:process.env.STRIPE_PUBLISHABLE_KEY||"",secretKey:process.env.STRIPE_SECRET_KEY||"",webhookSecret:process.env.STRIPE_WEBHOOK_SECRET||""},alipay:{appId:process.env.ALIPAY_APP_ID||"",privateKey:process.env.ALIPAY_PRIVATE_KEY||"",publicKey:process.env.ALIPAY_PUBLIC_KEY||""}}},i=s.usdtWallets.filter(e=>e.isActive),n=s.paymentReceivers.filter(e=>e.isActive);async function o(){let e=i.filter(e=>e.isActive);return e.length>0?e[0]:null}async function u(e){let t=n.find(t=>t.type===e&&t.isActive);return t||null}async function c(e,t,a){let s=await o();if(!s)throw Error("No available USDT wallet");let i=(0,r.e)();return await i.from("payments").update({status:"pending",metadata:{usdt_address:s.address,usdt_network:s.network,usdt_amount:t,payment_id:e,user_id:a,created_at:new Date().toISOString()}}).eq("id",e),{address:s.address,amount:t,network:s.network,paymentId:e}}async function d(e,t,a){let s=await u("alipay");if(!s)throw Error("Alipay receiver not available");let i={amount:t,account:s.account,paymentId:e,timestamp:Date.now()},n=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(JSON.stringify(i))}`,o=(0,r.e)();return await o.from("payments").update({status:"pending",metadata:{alipay_account:s.account,alipay_amount:t,alipay_qr_code:n,payment_id:e,user_id:a,created_at:new Date().toISOString()}}).eq("id",e),{qrCode:n,amount:t,account:s.account,paymentId:e}}async function p(e,t,a,s){try{let i=(0,r.e)(),{data:n,error:o}=await i.from("payments").select("*").eq("id",e).single();if(o||!n)return!1;let u=n.metadata?.usdt_amount,c=n.metadata?.usdt_address;if(a!==u||s.toLowerCase()!==c.toLowerCase())return!1;await i.from("payments").update({status:"completed",metadata:{...n.metadata,transaction_hash:t,verified_at:new Date().toISOString()}}).eq("id",e);let d=n.metadata?.credits||0;return d>0&&(await m(n.user_id,d),await y(n.user_id,"credit_purchase",d,`Purchased ${d} credits via USDT`,{payment_id:e,transaction_hash:t,payment_method:"usdt"})),!0}catch(e){return!1}}async function l(e,t,a){try{let s=(0,r.e)(),{data:i,error:n}=await s.from("payments").select("*").eq("id",e).single();if(n||!i)return!1;let o=i.metadata?.alipay_amount;if(a!==o)return!1;await s.from("payments").update({status:"completed",metadata:{...i.metadata,alipay_transaction_id:t,verified_at:new Date().toISOString()}}).eq("id",e);let u=i.metadata?.credits||0;return u>0&&(await m(i.user_id,u),await y(i.user_id,"credit_purchase",u,`Purchased ${u} credits via Alipay`,{payment_id:e,alipay_transaction_id:t,payment_method:"alipay"})),!0}catch(e){return!1}}async function m(e,t){let a=(0,r.e)(),{data:s,error:i}=await a.from("profiles").select("credits").eq("id",e).single();if(i)throw Error(`Failed to fetch user profile: ${i.message}`);let n=s?.credits||0,{error:o}=await a.from("profiles").update({credits:n+t,updated_at:new Date().toISOString()}).eq("id",e);if(o)throw Error(`Failed to add credits to user: ${o.message}`)}async function y(e,t,a,s,i){let n=(0,r.e)(),{error:o}=await n.from("transactions").insert({user_id:e,type:t,amount:a,currency:"CNY",description:s,status:"completed",metadata:i});if(o)throw Error(`Failed to create transaction record: ${o.message}`)}},69978:(e,t,a)=>{"use strict";a.d(t,{e:()=>i});var r=a(74280),s=a(24596);let i=()=>{let e=(0,s.cookies)();return(0,r.createServerClient)("https://bamratexknmqvdbalzen.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJhbXJhdGV4a25tcXZkYmFsemVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MTM4NzEsImV4cCI6MjA2ODA4OTg3MX0.yYa98ioJLLouUgHWITGb7U_VjNCTUuM-5NcraM7f3zA",{cookies:{get:t=>e.get(t)?.value,set(t,a,r){e.set({name:t,value:a,...r})},remove(t,a){e.set({name:t,value:"",...a})}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[3271,8107,6163,782],()=>a(38100));module.exports=r})();