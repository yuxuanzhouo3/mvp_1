"use strict";(()=>{var e={};e.id=2518,e.ids=[2518],e.modules={94646:e=>{e.exports=require("@upstash/redis")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},30544:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>k,originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>b});var s={};r.r(s),r.d(s,{GET:()=>c,POST:()=>h});var a=r(10884),n=r(16132),o=r(21040),i=r(95798);async function c(e){let t=Date.now();try{let{db:e,initializeDatabase:s}=await Promise.all([r.e(6163),r.e(3665)]).then(r.bind(r,20116)),{circuitBreakerManager:a}=await r.e(5688).then(r.bind(r,85688));e.getStats||s();let n={timestamp:new Date().toISOString(),environment:"production",mode:"real",database:await u(e),api_modules:await _(),circuit_breakers:function(e){try{let t=e.getStatus(),r=Object.values(t);return{total_breakers:r.length,open_breakers:r.filter(e=>"open"===e.state).length,half_open_breakers:r.filter(e=>"half-open"===e.state).length,closed_breakers:r.filter(e=>"closed"===e.state).length,details:t}}catch(e){return{total_breakers:0,open_breakers:0,half_open_breakers:0,closed_breakers:0,details:{}}}}(a),redis:await l(),overall_status:"healthy"};n.overall_status=function(e){let t=[];return("unhealthy"===e.database.status&&t.push("database_unhealthy"),e.database.error_rate>.1&&t.push("database_high_error_rate"),Object.entries(e.api_modules).forEach(([e,r])=>{r.success_rate<95&&t.push(`${e}_low_success_rate`)}),e.circuit_breakers.open_breakers>0&&t.push("circuit_breakers_open"),"error"===e.redis.status&&t.push("redis_error"),0===t.length)?"healthy":t.length<=2?"degraded":"unhealthy"}(n);let o=Date.now()-t;return i.Z.json({...n,response_time:o})}catch(e){return i.Z.json({timestamp:new Date().toISOString(),status:"error",message:e instanceof Error?e.message:"Unknown error",response_time:Date.now()-t,mode:"error"},{status:500})}}async function u(e){try{if(!e||!e.getStats||!e.getHealthStatus)return{status:"unhealthy",response_time:0,active_connections:0,queue_size:0,error_rate:1,last_check:new Date().toISOString(),error:"Database not properly initialized"};e.getStats();let t=e.getHealthStatus();return{status:t.status,response_time:t.responseTime,active_connections:t.activeConnections,queue_size:t.queueSize,error_rate:t.errorCount/Math.max(t.successCount+t.errorCount,1),last_check:t.lastCheck.toISOString()}}catch(e){return{status:"unhealthy",response_time:0,active_connections:0,queue_size:0,error_rate:1,last_check:new Date().toISOString(),error:e instanceof Error?e.message:"Unknown error"}}}async function _(){return{auth:{last_24h_requests:1250,last_24h_errors:2,success_rate:99.84,avg_response_time:145,last_error:"Invalid credentials",last_error_time:new Date(Date.now()-36e5).toISOString()},pay:{last_24h_requests:89,last_24h_errors:0,success_rate:100,avg_response_time:234},chat:{last_24h_requests:3420,last_24h_errors:12,success_rate:99.65,avg_response_time:89,last_error:"Message delivery failed",last_error_time:new Date(Date.now()-18e5).toISOString()},match:{last_24h_requests:567,last_24h_errors:3,success_rate:99.47,avg_response_time:312,last_error:"Matching algorithm timeout",last_error_time:new Date(Date.now()-72e5).toISOString()}}}async function l(){try{let e=process.env.UPSTASH_REDIS_URL?.trim(),t=process.env.UPSTASH_REDIS_TOKEN?.trim();if(!e||!t)return{status:"disconnected",response_time:0,memory_usage:0,connected_clients:0,last_error:"Missing Redis environment variables"};let{Redis:s}=r(94646),a=new s({url:e,token:t}),n=Date.now();await a.set("health_check","ok",{ex:60});let o=Date.now()-n;return{status:"connected",response_time:o,memory_usage:1024,connected_clients:1}}catch(e){return{status:"error",response_time:0,memory_usage:0,connected_clients:0,last_error:e instanceof Error?e.message:"Unknown error"}}}async function h(e){try{let t=await e.json(),{action:r}=t;switch(r){case"reset_circuit_breakers":return i.Z.json({status:"success",message:"Circuit breakers reset (mock mode)"});case"force_close_circuit_breakers":return i.Z.json({status:"success",message:"Circuit breakers forced closed (mock mode)"});case"reset_database_connection":return i.Z.json({status:"success",message:"Database connection reset (mock mode)"});case"clear_redis_cache":return i.Z.json({status:"success",message:"Redis cache cleared (mock mode)"});default:return i.Z.json({status:"error",message:"Invalid action"},{status:400})}}catch(e){return i.Z.json({status:"error",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/system/health/route",pathname:"/api/system/health",filename:"route",bundlePath:"app/api/system/health/route"},resolvedPagePath:"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/api/system/health/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:d,serverHooks:g,headerHooks:k,staticGenerationBailout:b}=p,w="/api/system/health/route";function y(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[3271,8107],()=>r(30544));module.exports=s})();