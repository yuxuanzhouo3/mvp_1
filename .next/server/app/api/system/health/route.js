"use strict";(()=>{var e={};e.id=2518,e.ids=[2518],e.modules={94646:e=>{e.exports=require("@upstash/redis")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},30544:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>v,originalPathname:()=>S,patchFetch:()=>k,requestAsyncStorage:()=>b,routeModule:()=>g,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>y});var s={};r.r(s),r.d(s,{GET:()=>_,POST:()=>m});var a=r(10884),n=r(16132),o=r(21040),i=r(95798),u=r(20116),c=r(85688);function l(){let e=process.env.UPSTASH_REDIS_URL?.trim(),t=process.env.UPSTASH_REDIS_TOKEN?.trim();if(!e||!t)throw Error("Missing Redis environment variables");let{Redis:s}=r(94646);return new s({url:e,token:t})}async function _(e){let t=Date.now();try{let e={timestamp:new Date().toISOString(),environment:"production",database:await h(),api_modules:await p(),circuit_breakers:function(){let e=c.OJ.getStatus(),t=Object.values(e);return{total_breakers:t.length,open_breakers:t.filter(e=>"open"===e.state).length,half_open_breakers:t.filter(e=>"half-open"===e.state).length,closed_breakers:t.filter(e=>"closed"===e.state).length,details:e}}(),redis:await d(),overall_status:"healthy"};e.overall_status=function(e){let t=[];return("unhealthy"===e.database.status&&t.push("database_unhealthy"),e.database.error_rate>.1&&t.push("database_high_error_rate"),Object.entries(e.api_modules).forEach(([e,r])=>{r.success_rate<95&&t.push(`${e}_low_success_rate`)}),e.circuit_breakers.open_breakers>0&&t.push("circuit_breakers_open"),"error"===e.redis.status&&t.push("redis_error"),0===t.length)?"healthy":t.length<=2?"degraded":"unhealthy"}(e);let r=Date.now()-t;return i.Z.json({...e,response_time:r})}catch(e){return i.Z.json({timestamp:new Date().toISOString(),status:"error",message:e instanceof Error?e.message:"Unknown error",response_time:Date.now()-t},{status:500})}}async function h(){u.db.getStats();let e=u.db.getHealthStatus();return{status:e.status,response_time:e.responseTime,active_connections:e.activeConnections,queue_size:e.queueSize,error_rate:e.errorCount/Math.max(e.successCount+e.errorCount,1),last_check:e.lastCheck.toISOString()}}async function p(){return{auth:{last_24h_requests:1250,last_24h_errors:2,success_rate:99.84,avg_response_time:145,last_error:"Invalid credentials",last_error_time:new Date(Date.now()-36e5).toISOString()},pay:{last_24h_requests:89,last_24h_errors:0,success_rate:100,avg_response_time:234},chat:{last_24h_requests:3420,last_24h_errors:12,success_rate:99.65,avg_response_time:89,last_error:"Message delivery failed",last_error_time:new Date(Date.now()-18e5).toISOString()},match:{last_24h_requests:567,last_24h_errors:3,success_rate:99.47,avg_response_time:312,last_error:"Matching algorithm timeout",last_error_time:new Date(Date.now()-72e5).toISOString()}}}async function d(){try{let e=Date.now();await l().set("health_check","ok",{ex:60});let t=Date.now()-e;return{status:"connected",response_time:t,memory_usage:0,connected_clients:1}}catch(e){return{status:"error",response_time:0,memory_usage:0,connected_clients:0,last_error:e instanceof Error?e.message:"Unknown error"}}}async function m(e){try{let t=await e.json(),{action:r}=t;switch(r){case"reset_circuit_breakers":return c.OJ.resetAll(),i.Z.json({status:"success",message:"All circuit breakers reset"});case"force_close_circuit_breakers":return c.OJ.forceCloseAll(),i.Z.json({status:"success",message:"All circuit breakers forced closed"});case"reset_database_connection":return await u.db.resetConnection(),i.Z.json({status:"success",message:"Database connection reset"});case"clear_redis_cache":return await l().flushdb(),i.Z.json({status:"success",message:"Redis cache cleared"});default:return i.Z.json({status:"error",message:"Invalid action"},{status:400})}}catch(e){return i.Z.json({status:"error",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}u.db.getStats||(0,u.x)();let g=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/system/health/route",pathname:"/api/system/health",filename:"route",bundlePath:"app/api/system/health/route"},resolvedPagePath:"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/api/system/health/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:b,staticGenerationAsyncStorage:f,serverHooks:w,headerHooks:v,staticGenerationBailout:y}=g,S="/api/system/health/route";function k(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[3271,1945,8107,3665],()=>r(30544));module.exports=s})();