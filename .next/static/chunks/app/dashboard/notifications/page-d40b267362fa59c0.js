(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[258],{8067:function(e,t,r){Promise.resolve().then(r.bind(r,121))},121:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var a=r(7437),s=r(2265),n=r(4033),i=r(4620),l=r(9598),c=r(3611),d=r(708),o=r(7702),u=r(446),x=r(7810),m=r(2882),f=r(3021),h=r(2442),p=r(3067),N=r(1396),g=r.n(N);function j(){let e=(0,n.useRouter)(),{user:t}=(0,i.a)(),{toast:r}=(0,u.p)(),[N,j]=(0,s.useState)([]),[y,v]=(0,s.useState)(!0),[b,w]=(0,s.useState)(0);(0,s.useEffect)(()=>{if(!t){e.push("/auth/login");return}k()},[t]);let k=async()=>{try{v(!0);let e=await fetch("/api/user/notifications");if(e.ok){let t=await e.json();j(t.notifications),w(t.notifications.filter(e=>!e.is_read).length)}}catch(e){r({title:"加载失败",description:"无法加载通知",variant:"destructive"})}finally{v(!1)}},C=async e=>{try{let t=await fetch("/api/user/notifications/".concat(e,"/read"),{method:"PUT"});t.ok&&(j(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t)),w(e=>Math.max(0,e-1)))}catch(e){r({title:"操作失败",description:"无法标记为已读",variant:"destructive"})}},_=async()=>{try{let e=await fetch("/api/user/notifications/read-all",{method:"PUT"});e.ok&&(j(e=>e.map(e=>({...e,is_read:!0}))),w(0),r({title:"已全部标记为已读"}))}catch(e){r({title:"操作失败",description:"无法标记全部为已读",variant:"destructive"})}},Z=t=>{t.is_read||C(t.id),t.action_url&&e.push(t.action_url)},R=e=>{switch(e){case"match":return(0,a.jsx)(x.Z,{className:"h-5 w-5 text-red-500"});case"message":return(0,a.jsx)(m.Z,{className:"h-5 w-5 text-blue-500"});case"payment":return(0,a.jsx)(f.Z,{className:"h-5 w-5 text-green-500"});default:return(0,a.jsx)(f.Z,{className:"h-5 w-5 text-gray-500"})}},E=e=>{switch(e){case"match":return(0,a.jsx)(d.C,{variant:"destructive",className:"bg-red-100 text-red-800",children:"匹配"});case"message":return(0,a.jsx)(d.C,{variant:"default",className:"bg-blue-100 text-blue-800",children:"消息"});case"payment":return(0,a.jsx)(d.C,{variant:"default",className:"bg-green-100 text-green-800",children:"支付"});default:return(0,a.jsx)(d.C,{variant:"secondary",children:"系统"})}},z=e=>{let t=new Date(e),r=new Date,a=(r.getTime()-t.getTime())/36e5;return a<1?"刚刚":a<24?"".concat(Math.floor(a),"小时前"):a<168?"".concat(Math.floor(a/24),"天前"):t.toLocaleDateString("zh-CN")};return y?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"加载通知中..."})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"通知中心"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"查看您的所有通知和消息"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[b>0&&(0,a.jsxs)(c.z,{variant:"outline",onClick:_,children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"全部已读"]}),(0,a.jsx)(g(),{href:"/dashboard",children:(0,a.jsxs)(c.z,{variant:"outline",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"返回仪表盘"]})})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:0===N.length?(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.aY,{className:"text-center py-12",children:[(0,a.jsx)(f.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"暂无通知"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"当有新消息、匹配或其他重要事件时，您会在这里看到通知"})]})}):N.map(e=>(0,a.jsx)(l.Zb,{className:"cursor-pointer transition-all hover:shadow-md ".concat(e.is_read?"":"border-blue-200 bg-blue-50 dark:bg-blue-900/20"),onClick:()=>Z(e),children:(0,a.jsx)(l.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0 mt-1",children:R(e.type)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),E(e.type),!e.is_read&&(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:z(e.created_at)}),!e.is_read&&(0,a.jsx)(c.z,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),C(e.id)},children:(0,a.jsx)(h.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:e.message}),e.sender&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,a.jsxs)(o.qE,{className:"h-6 w-6",children:[(0,a.jsx)(o.F$,{src:e.sender.avatar_url}),(0,a.jsx)(o.Q5,{children:e.sender.name.charAt(0).toUpperCase()})]}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:e.sender.name})]})]})]})})},e.id))})]})})}},7702:function(e,t,r){"use strict";r.d(t,{F$:function(){return c},Q5:function(){return d},qE:function(){return l}});var a=r(7437),s=r(2265),n=r(1465),i=r(1628);let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n.fC,{ref:t,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...s})});l.displayName=n.fC.displayName;let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n.Ee,{ref:t,className:(0,i.cn)("aspect-square h-full w-full",r),...s})});c.displayName=n.Ee.displayName;let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n.NY,{ref:t,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...s})});d.displayName=n.NY.displayName},708:function(e,t,r){"use strict";r.d(t,{C:function(){return l}});var a=r(7437);r(2265);var s=r(6061),n=r(1628);let i=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:r,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)(i({variant:r}),t),...s})}},9598:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return i},aY:function(){return o},ll:function(){return c}});var a=r(7437),s=r(2265),n=r(1628);let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});i.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...s})});l.displayName="CardHeader";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});c.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...s})});d.displayName="CardDescription";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...s})});o.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...s})});u.displayName="CardFooter"},446:function(e,t,r){"use strict";r.d(t,{p:function(){return s}});var a=r(1271);let s=a.pm}},function(e){e.O(0,[216,689,744],function(){return e(e.s=8067)}),_N_E=e.O()}]);