(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[258],{8067:function(e,a,s){Promise.resolve().then(s.bind(s,121))},121:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return p}});var t=s(7437),r=s(2265),i=s(4033),c=s(4620),n=s(9598),l=s(3611),d=s(708),x=s(7702),m=s(446),h=s(7810),o=s(2882),u=s(3021),j=s(2442),f=s(3067),g=s(1396),N=s.n(g);function p(){let e=(0,i.useRouter)(),{user:a}=(0,c.a)(),{toast:s}=(0,m.p)(),[g,p]=(0,r.useState)([]),[v,b]=(0,r.useState)(!0),[y,w]=(0,r.useState)(0);(0,r.useEffect)(()=>{if(!a){e.push("/auth/login");return}k()},[a]);let k=async()=>{try{b(!0);let e=await fetch("/api/user/notifications");if(e.ok){let a=await e.json();p(a.notifications),w(a.notifications.filter(e=>!e.is_read).length)}}catch(e){s({title:"加载失败",description:"无法加载通知",variant:"destructive"})}finally{b(!1)}},_=async e=>{try{let a=await fetch("/api/user/notifications/".concat(e,"/read"),{method:"PUT"});a.ok&&(p(a=>a.map(a=>a.id===e?{...a,is_read:!0}:a)),w(e=>Math.max(0,e-1)))}catch(e){s({title:"操作失败",description:"无法标记为已读",variant:"destructive"})}},C=async()=>{try{let e=await fetch("/api/user/notifications/read-all",{method:"PUT"});e.ok&&(p(e=>e.map(e=>({...e,is_read:!0}))),w(0),s({title:"已全部标记为已读"}))}catch(e){s({title:"操作失败",description:"无法标记全部为已读",variant:"destructive"})}},Z=a=>{a.is_read||_(a.id),a.action_url&&e.push(a.action_url)},z=e=>{switch(e){case"match":return(0,t.jsx)(h.Z,{className:"h-5 w-5 text-red-500"});case"message":return(0,t.jsx)(o.Z,{className:"h-5 w-5 text-blue-500"});case"payment":return(0,t.jsx)(u.Z,{className:"h-5 w-5 text-green-500"});default:return(0,t.jsx)(u.Z,{className:"h-5 w-5 text-gray-500"})}},A=e=>{switch(e){case"match":return(0,t.jsx)(d.C,{variant:"destructive",className:"bg-red-100 text-red-800",children:"匹配"});case"message":return(0,t.jsx)(d.C,{variant:"default",className:"bg-blue-100 text-blue-800",children:"消息"});case"payment":return(0,t.jsx)(d.C,{variant:"default",className:"bg-green-100 text-green-800",children:"支付"});default:return(0,t.jsx)(d.C,{variant:"secondary",children:"系统"})}},E=e=>{let a=new Date(e),s=new Date,t=(s.getTime()-a.getTime())/36e5;return t<1?"刚刚":t<24?"".concat(Math.floor(t),"小时前"):t<168?"".concat(Math.floor(t/24),"天前"):a.toLocaleDateString("zh-CN")};return v?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"加载通知中..."})]})}):(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"通知中心"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"查看您的所有通知和消息"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[y>0&&(0,t.jsxs)(l.z,{variant:"outline",onClick:C,children:[(0,t.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"全部已读"]}),(0,t.jsx)(N(),{href:"/dashboard",children:(0,t.jsxs)(l.z,{variant:"outline",children:[(0,t.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"返回仪表盘"]})})]})]}),(0,t.jsx)("div",{className:"space-y-4",children:0===g.length?(0,t.jsx)(n.Zb,{children:(0,t.jsxs)(n.aY,{className:"text-center py-12",children:[(0,t.jsx)(u.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"暂无通知"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"当有新消息、匹配或其他重要事件时，您会在这里看到通知"})]})}):g.map(e=>(0,t.jsx)(n.Zb,{className:"cursor-pointer transition-all hover:shadow-md ".concat(e.is_read?"":"border-blue-200 bg-blue-50 dark:bg-blue-900/20"),onClick:()=>Z(e),children:(0,t.jsx)(n.aY,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 mt-1",children:z(e.type)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),A(e.type),!e.is_read&&(0,t.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"text-sm text-gray-500",children:E(e.created_at)}),!e.is_read&&(0,t.jsx)(l.z,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),_(e.id)},children:(0,t.jsx)(j.Z,{className:"h-4 w-4"})})]})]}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:e.message}),e.sender&&(0,t.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,t.jsxs)(x.Avatar,{className:"h-6 w-6",children:[(0,t.jsx)(x.AvatarImage,{src:e.sender.avatar_url}),(0,t.jsx)(x.AvatarFallback,{children:e.sender.name.charAt(0).toUpperCase()})]}),(0,t.jsx)("span",{className:"text-sm text-gray-500",children:e.sender.name})]})]})]})})},e.id))})]})})}}},function(e){e.O(0,[216,930,744],function(){return e(e.s=8067)}),_N_E=e.O()}]);