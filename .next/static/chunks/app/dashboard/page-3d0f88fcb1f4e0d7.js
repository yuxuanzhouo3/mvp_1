(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{261:function(e,s,a){Promise.resolve().then(a.bind(a,227))},227:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return k}});var r=a(7437),t=a(2265),l=a(4620),i=a(4033),n=a(9598),c=a(3611),d=a(708),x=a(7702),m=a(446),h=a(1492),o=a(2882),u=a(9409),j=a(7972),g=a(6142),f=a(1738),p=a(9883),N=a(7810),y=a(5750),v=a(5790),b=a(8203);let w=(0,h.createClient)("https://bamratexknmqvdbalzen.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJhbXJhdGV4a25tcXZkYmFsemVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MTM4NzEsImV4cCI6MjA2ODA4OTg3MX0.yYa98ioJLLouUgHWITGb7U_VjNCTUuM-5NcraM7f3zA");function k(){var e;let{user:s,signOut:a}=(0,l.a)(),h=(0,i.useRouter)(),{toast:k}=(0,m.p)(),[C,Z]=(0,t.useState)(null),[_,z]=(0,t.useState)([]),[I,Y]=(0,t.useState)(null),[O,S]=(0,t.useState)(!0),[E,M]=(0,t.useState)(!1),R=async()=>{try{S(!0);let{data:{session:e}}=await w.auth.getSession();if(!(null==e?void 0:e.access_token))return;let s={Authorization:"Bearer ".concat(e.access_token),"Content-Type":"application/json"},a=await fetch("/api/user/profile",{headers:s});if(a.ok){let e=await a.json();Z(e.profile)}let r=await fetch("/api/user/matches?limit=5",{headers:s});if(r.ok){let e=await r.json();z(e.matches)}let t=await fetch("/api/user/stats",{headers:s});if(t.ok){let e=await t.json();Y(e.stats)}}catch(e){k({title:"加载失败",description:"无法加载仪表盘数据",variant:"destructive"})}finally{S(!1)}};if((0,t.useEffect)(()=>{let e=setTimeout(()=>{if(M(!0),s)R();else{h.replace("/auth/login");return}},500);return()=>clearTimeout(e)},[s,h]),!E)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-64 animate-pulse"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-96 animate-pulse"})]}),(0,r.jsxs)("div",{className:"flex space-x-4",children:[(0,r.jsx)("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded w-24 animate-pulse"}),(0,r.jsx)("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded w-16 animate-pulse"}),(0,r.jsx)("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded w-20 animate-pulse"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,r.jsx)("div",{className:"lg:col-span-1 space-y-6",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-full animate-pulse"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32 animate-pulse"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-24 animate-pulse"})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-full animate-pulse"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4 animate-pulse"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2 animate-pulse"})]})]})}),(0,r.jsx)("div",{className:"lg:col-span-2 space-y-6",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6",children:[(0,r.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-48 mb-4 animate-pulse"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2 animate-pulse"})]},e))})]})})]})]})});let J=async()=>{try{await a(),h.push("/"),k({title:"已退出登录",description:"期待您的再次光临！"})}catch(e){k({title:"退出失败",description:"请稍后重试",variant:"destructive"})}},T=()=>{h.push("/matching")},D=()=>{h.push("/chat")};return O?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"加载中..."})]})}):C?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["欢迎回来，",C.full_name,"！"]}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"发现新的朋友，开始有趣的对话"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)(c.z,{variant:"outline",onClick:D,children:[(0,r.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"查看聊天"]}),(0,r.jsxs)(c.z,{variant:"outline",onClick:()=>h.push("/settings"),children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"设置"]}),(0,r.jsx)(c.z,{variant:"outline",onClick:J,children:"退出登录"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,r.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,r.jsxs)(n.Zb,{children:[(0,r.jsx)(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"flex items-center",children:[(0,r.jsx)(j.Z,{className:"h-5 w-5 mr-2"}),"个人资料"]})}),(0,r.jsxs)(n.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)(x.qE,{className:"h-16 w-16",children:[(0,r.jsx)(x.F$,{src:C.avatar_url}),(0,r.jsx)(x.Q5,{children:null===(e=C.full_name)||void 0===e?void 0:e.charAt(0).toUpperCase()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold",children:C.full_name}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:C.email}),C.location&&(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center",children:[(0,r.jsx)(g.Z,{className:"h-3 w-3 mr-1"}),C.location]})]})]}),C.bio&&(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:C.bio}),C.interests.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium mb-2",children:"兴趣爱好"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-1",children:[C.interests.slice(0,5).map((e,s)=>(0,r.jsx)(d.C,{variant:"secondary",className:"text-xs",children:e},s)),C.interests.length>5&&(0,r.jsxs)(d.C,{variant:"outline",className:"text-xs",children:["+",C.interests.length-5]})]})]}),(0,r.jsx)(c.z,{variant:"outline",className:"w-full",onClick:()=>h.push("/profile/edit"),children:"编辑资料"})]})]}),(0,r.jsxs)(n.Zb,{children:[(0,r.jsx)(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"flex items-center",children:[(0,r.jsx)(f.Z,{className:"h-5 w-5 mr-2"}),"积分余额"]})}),(0,r.jsx)(n.aY,{children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:C.credits}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"可用积分"}),(0,r.jsxs)(c.z,{onClick:()=>{h.push("/payment/recharge")},className:"w-full",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"充值积分"]})]})})]}),(0,r.jsxs)(n.Zb,{children:[(0,r.jsx)(n.Ol,{children:(0,r.jsx)(n.ll,{children:"快速操作"})}),(0,r.jsxs)(n.aY,{className:"space-y-3",children:[(0,r.jsxs)(c.z,{onClick:T,className:"w-full",children:[(0,r.jsx)(N.Z,{className:"h-4 w-4 mr-2"}),"开始匹配"]}),(0,r.jsxs)(c.z,{variant:"outline",onClick:D,className:"w-full",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"查看聊天"]}),(0,r.jsxs)(c.z,{variant:"outline",onClick:()=>h.push("/matching/history"),className:"w-full",children:[(0,r.jsx)(y.Z,{className:"h-4 w-4 mr-2"}),"匹配历史"]})]})]})]}),(0,r.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[I&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsx)(n.Zb,{children:(0,r.jsx)(n.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(N.Z,{className:"h-8 w-8 text-red-500 mr-3"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"总匹配数"}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:I.totalMatches})]})]})})}),(0,r.jsx)(n.Zb,{children:(0,r.jsx)(n.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(o.Z,{className:"h-8 w-8 text-blue-500 mr-3"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"消息数量"}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:I.totalMessages})]})]})})}),(0,r.jsx)(n.Zb,{children:(0,r.jsx)(n.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(y.Z,{className:"h-8 w-8 text-green-500 mr-3"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"活跃聊天"}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:I.activeChats})]})]})})}),(0,r.jsx)(n.Zb,{children:(0,r.jsx)(n.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(v.Z,{className:"h-8 w-8 text-purple-500 mr-3"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"资料完整度"}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:[I.profileCompletion,"%"]})]})]})})})]}),(0,r.jsxs)(n.Zb,{children:[(0,r.jsxs)(n.Ol,{children:[(0,r.jsxs)(n.ll,{className:"flex items-center justify-between",children:[(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)(N.Z,{className:"h-5 w-5 mr-2"}),"最近匹配"]}),(0,r.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>h.push("/matching/history"),children:"查看全部"})]}),(0,r.jsx)(n.SZ,{children:"您最近的匹配对象"})]}),(0,r.jsx)(n.aY,{children:0===_.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(N.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"还没有匹配记录"}),(0,r.jsx)(c.z,{onClick:T,children:"开始匹配"})]}):(0,r.jsx)("div",{className:"space-y-4",children:_.map(e=>{var s;return(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors cursor-pointer",onClick:()=>h.push("/chat/".concat(e.id)),children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)(x.qE,{children:[(0,r.jsx)(x.F$,{src:e.matched_user.avatar_url}),(0,r.jsx)(x.Q5,{children:null===(s=e.matched_user.full_name)||void 0===s?void 0:s.charAt(0).toUpperCase()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:e.matched_user.full_name}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["匹配于 ",new Date(e.matched_at).toLocaleDateString()]})]})]}),(0,r.jsx)("div",{className:"text-right",children:(0,r.jsxs)(d.C,{variant:"secondary",children:[Math.round(100*e.compatibility_score),"% 匹配"]})})]},e.id)})})})]}),(0,r.jsxs)(n.Zb,{children:[(0,r.jsx)(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"flex items-center",children:[(0,r.jsx)(b.Z,{className:"h-5 w-5 mr-2"}),"活动摘要"]})}),(0,r.jsx)(n.aY,{children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"本周新匹配"}),(0,r.jsx)("span",{className:"font-medium",children:_.filter(e=>new Date(e.matched_at)>new Date(Date.now()-6048e5)).length})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"活跃天数"}),(0,r.jsx)("span",{className:"font-medium",children:Math.floor((Date.now()-new Date(C.created_at).getTime())/864e5)})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"平均响应时间"}),(0,r.jsx)("span",{className:"font-medium",children:"2.3 小时"})]})]})})]})]})]})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,r.jsxs)(n.Zb,{className:"w-full max-w-md",children:[(0,r.jsxs)(n.Ol,{children:[(0,r.jsx)(n.ll,{children:"用户资料未找到"}),(0,r.jsx)(n.SZ,{children:"请完善您的个人资料"})]}),(0,r.jsx)(n.aY,{children:(0,r.jsx)(c.z,{onClick:()=>h.push("/profile/setup"),className:"w-full",children:"设置个人资料"})})]})})}},7702:function(e,s,a){"use strict";a.d(s,{F$:function(){return c},Q5:function(){return d},qE:function(){return n}});var r=a(7437),t=a(2265),l=a(1465),i=a(1628);let n=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.fC,{ref:s,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...t})});n.displayName=l.fC.displayName;let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.Ee,{ref:s,className:(0,i.cn)("aspect-square h-full w-full",a),...t})});c.displayName=l.Ee.displayName;let d=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.NY,{ref:s,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...t})});d.displayName=l.NY.displayName},708:function(e,s,a){"use strict";a.d(s,{C:function(){return n}});var r=a(7437);a(2265);var t=a(6061),l=a(1628);let i=(0,t.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:a,...t}=e;return(0,r.jsx)("div",{className:(0,l.cn)(i({variant:a}),s),...t})}},9598:function(e,s,a){"use strict";a.d(s,{Ol:function(){return n},SZ:function(){return d},Zb:function(){return i},aY:function(){return x},ll:function(){return c}});var r=a(7437),t=a(2265),l=a(1628);let i=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...t})});i.displayName="Card";let n=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...t})});n.displayName="CardHeader";let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("h3",{ref:s,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",a),...t})});c.displayName="CardTitle";let d=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("p",{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",a),...t})});d.displayName="CardDescription";let x=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,l.cn)("p-6 pt-0",a),...t})});x.displayName="CardContent";let m=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,l.cn)("flex items-center p-6 pt-0",a),...t})});m.displayName="CardFooter"},446:function(e,s,a){"use strict";a.d(s,{p:function(){return t}});var r=a(1271);let t=r.pm}},function(e){e.O(0,[216,689,744],function(){return e(e.s=261)}),_N_E=e.O()}]);