(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{4885:function(e,t,r){Promise.resolve().then(r.bind(r,5680))},5680:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var n=r(7437),s=r(2265),a=r(4033),i=r(4620),o=r(1396),l=r.n(o),c=r(1628),u=r(3611),d=r(7702),f=r(446),h=r(7480),m=r(2882),x=r(7810),p=r(1738),v=r(9409),g=r(3021),b=r(5883);let y=[{name:"Dashboard",href:"/dashboard",icon:h.Z},{name:"Chat",href:"/chat",icon:m.Z},{name:"Matching",href:"/matching",icon:x.Z},{name:"Recharge",href:"/payment/recharge",icon:p.Z},{name:"Settings",href:"/dashboard/settings",icon:v.Z}],N=e=>{var t,r,o,h;let{user:m}=e,[x,p]=(0,s.useState)(!0),v=(0,a.usePathname)();(0,a.useRouter)();let{signOut:N}=(0,i.a)(),{toast:j}=(0,f.p)(),w=async()=>{try{await N(),window.location.href="/auth/login",j({title:"已退出登录",description:"期待您的再次光临！"})}catch(e){j({title:"退出失败",description:"请稍后重试",variant:"destructive"})}};return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("button",{onClick:()=>p(e=>!e),className:"absolute -left-12 top-4 z-50 p-2 rounded-md bg-background border shadow-md hover:bg-muted focus:outline-none transition-colors",title:x?"收起侧边栏":"展开侧边栏",children:x?(0,n.jsx)("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M15 19l-7-7 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}):(0,n.jsx)("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M9 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,n.jsxs)("div",{className:"flex flex-col ".concat(x?"w-64":"w-20"," bg-background border-r transition-all duration-200"),children:[(0,n.jsx)("div",{className:"flex items-center justify-center h-16 border-b px-4",children:(0,n.jsx)("h1",{className:"text-xl font-bold text-primary transition-opacity duration-200 ".concat(x?"opacity-100":"opacity-0 w-0 overflow-hidden"),children:"PersonaLink"})}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,n.jsx)("nav",{className:"flex-1 px-2 py-6 space-y-2",children:y.map(e=>{let t=v===e.href;return(0,n.jsxs)(l(),{href:e.href,className:(0,c.cn)("flex items-center px-2 py-2 text-sm font-medium rounded-md transition-colors",t?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[(0,n.jsx)(e.icon,{className:"h-5 w-5"}),x&&(0,n.jsx)("span",{className:"ml-3",children:e.name})]},e.name)})}),(0,n.jsxs)("div",{className:"border-t p-2 ".concat(x?"":"flex flex-col items-center"),children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3 mb-4 ".concat(x?"":"justify-center"),children:[(0,n.jsxs)(d.qE,{className:"h-10 w-10",children:[(0,n.jsx)(d.F$,{src:null==m?void 0:null===(t=m.user_metadata)||void 0===t?void 0:t.avatar_url}),(0,n.jsx)(d.Q5,{children:(null==m?void 0:null===(r=m.email)||void 0===r?void 0:r.charAt(0).toUpperCase())||"U"})]}),x&&(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-foreground truncate",children:(null==m?void 0:null===(o=m.user_metadata)||void 0===o?void 0:o.full_name)||(null==m?void 0:m.email)}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground truncate",children:[(null==m?void 0:null===(h=m.user_metadata)||void 0===h?void 0:h.credits)||0," credits"]})]})]}),(0,n.jsxs)("div",{className:"space-y-2 w-full ".concat(x?"":"flex flex-col items-center"),children:[(0,n.jsx)(u.z,{variant:"ghost",size:"sm",className:"w-full justify-start ".concat(x?"":"px-2"),asChild:!0,children:(0,n.jsxs)(l(),{href:"/dashboard/notifications",children:[(0,n.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),x&&"Notifications"]})}),(0,n.jsxs)(u.z,{variant:"ghost",size:"sm",className:"w-full justify-start text-destructive hover:text-destructive ".concat(x?"":"px-2"),onClick:w,children:[(0,n.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),x&&"Sign Out"]})]})]})]})]})]})};function j(e){let{children:t}=e,{user:r,loading:o}=(0,i.a)(),l=(0,a.useRouter)(),c=(0,a.usePathname)();return((0,s.useEffect)(()=>{o||r||l.replace("/auth/login")},[r,o,l]),o)?(0,n.jsx)("div",{className:"flex h-screen items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 border-b-2 border-purple-600"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading..."})]})}):r?(0,n.jsxs)("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[(0,n.jsx)(N,{user:r}),(0,n.jsx)("main",{className:"flex-1 overflow-y-auto",children:(0,n.jsx)("div",{className:"".concat("/dashboard/settings"===c?"p-0":"p-6"),children:t})})]}):null}},4620:function(e,t,r){"use strict";r.d(t,{H:function(){return l},a:function(){return c}});var n=r(7437),s=r(2265),a=r(1492);let i=null,o=(0,s.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[d,f]=(0,s.useState)(!0),h=(0,s.useRef)(!1),m=(0,s.useRef)(null),x=function(){if(!i){let e="https://bamratexknmqvdbalzen.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJhbXJhdGV4a25tcXZkYmFsemVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MTM4NzEsImV4cCI6MjA2ODA4OTg3MX0.yYa98ioJLLouUgHWITGb7U_VjNCTUuM-5NcraM7f3zA";if(!e||!t)throw Error("Missing Supabase environment variables");i=(0,a.eI)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:window.localStorage}})}return i}();(0,s.useEffect)(()=>{if(h.current)return;h.current=!0;let e=async()=>{try{let{data:{session:e},error:t}=await x.auth.getSession();t||e&&(u(e),l(e.user),m.current=e.user)}catch(e){}finally{f(!1)}};e();let{data:{subscription:t}}=x.auth.onAuthStateChange(async(e,t)=>{f(!0);try{"SIGNED_IN"===e&&t?(u(t),l(t.user),m.current=t.user):"SIGNED_OUT"===e?(u(null),l(null),m.current=null):"TOKEN_REFRESHED"===e&&t?(u(t),l(t.user)):"INITIAL_SESSION"===e&&(t?(u(t),l(t.user),m.current=t.user):(u(null),l(null),m.current=null))}catch(e){}finally{f(!1)}});return()=>{t.unsubscribe()}},[]);let p=(0,s.useCallback)(async(e,t)=>{let{error:r}=await x.auth.signInWithPassword({email:e,password:t});return{error:r}},[]),v=(0,s.useCallback)(async()=>{let{error:e}=await x.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});return{error:e}},[]),g=(0,s.useCallback)(async e=>{let{error:t}=await x.auth.signInWithOtp({phone:e});return{error:t}},[]),b=(0,s.useCallback)(async(e,t)=>{let{error:r}=await x.auth.verifyOtp({phone:e,token:t,type:"sms"});return{error:r}},[]),y=(0,s.useCallback)(async(e,t)=>{let{error:r}=await x.auth.signUp({email:e,password:t});return{error:r}},[]),N=(0,s.useCallback)(async()=>{try{let{error:e}=await x.auth.signOut();if(e)throw e;u(null),l(null),m.current=null,localStorage.removeItem("supabase.auth.token"),localStorage.removeItem("supabase.auth.expires_at"),localStorage.removeItem("supabase.auth.refresh_token")}catch(e){throw e}},[]);return(0,n.jsx)(o.Provider,{value:{user:r,session:c,loading:d,signIn:p,signInWithGoogle:v,signInWithPhone:g,verifyPhoneOTP:b,signUp:y,signOut:N},children:t})}function c(){let e=(0,s.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7702:function(e,t,r){"use strict";r.d(t,{F$:function(){return l},Q5:function(){return c},qE:function(){return o}});var n=r(7437),s=r(2265),a=r(1769),i=r(1628);let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.fC,{ref:t,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...s})});o.displayName=a.fC.displayName;let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.Ee,{ref:t,className:(0,i.cn)("aspect-square h-full w-full",r),...s})});l.displayName=a.Ee.displayName;let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.NY,{ref:t,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...s})});c.displayName=a.NY.displayName},3611:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var n=r(7437),s=r(2265),a=r(7256),i=r(6061),o=r(1628);let l=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:i,asChild:c=!1,...u}=e,d=c?a.g7:"button";return(0,n.jsx)(d,{className:(0,o.cn)(l({variant:s,size:i,className:r})),ref:t,...u})});c.displayName="Button"},1271:function(e,t,r){"use strict";r.d(t,{pm:function(){return f}});var n=r(2265);let s=0,a=new Map,i=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?i(r):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function u(e){c=o(c,e),l.forEach(e=>{e(c)})}function d(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>u({type:"DISMISS_TOAST",toastId:r});return u({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||n()}}}),{id:r,dismiss:n,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function f(){let[e,t]=n.useState(c);return n.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},446:function(e,t,r){"use strict";r.d(t,{p:function(){return s}});var n=r(1271);let s=n.pm},1628:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var n=r(7042),s=r(4769);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}}},function(e){e.O(0,[216,744],function(){return e(e.s=4885)}),_N_E=e.O()}]);