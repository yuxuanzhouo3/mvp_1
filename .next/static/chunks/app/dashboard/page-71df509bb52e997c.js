(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{261:function(e,s,a){Promise.resolve().then(a.bind(a,227))},227:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return b}});var l=a(7437),t=a(2265),r=a(4620),c=a(4033),i=a(9598),n=a(3611),x=a(708),d=a(7702),m=a(446),h=a(2882),j=a(9409),o=a(7972),u=a(6142),N=a(1738),p=a(9883),f=a(7810),g=a(5750),v=a(5790),y=a(8203);function b(){var e;let{user:s,signOut:a}=(0,r.a)(),b=(0,c.useRouter)(),{toast:w}=(0,m.p)(),[k,Z]=(0,t.useState)(null),[C,_]=(0,t.useState)([]),[z,Y]=(0,t.useState)(null),[A,O]=(0,t.useState)(!0);(0,t.useEffect)(()=>{if(!s){b.push("/auth/login");return}D()},[s]);let D=async()=>{try{O(!0);let e=await fetch("/api/user/profile");if(e.ok){let s=await e.json();Z(s.profile)}let s=await fetch("/api/user/matches?limit=5");if(s.ok){let e=await s.json();_(e.matches)}let a=await fetch("/api/user/stats");if(a.ok){let e=await a.json();Y(e.stats)}}catch(e){w({title:"加载失败",description:"无法加载仪表盘数据",variant:"destructive"})}finally{O(!1)}},S=async()=>{try{await a(),b.push("/"),w({title:"已退出登录",description:"期待您的再次光临！"})}catch(e){w({title:"退出失败",description:"请稍后重试",variant:"destructive"})}},E=()=>{b.push("/matching")},M=()=>{b.push("/chat")};return A?(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"加载中..."})]})}):k?(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["欢迎回来，",k.full_name,"！"]}),(0,l.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"发现新的朋友，开始有趣的对话"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)(n.z,{variant:"outline",onClick:M,children:[(0,l.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"查看聊天"]}),(0,l.jsxs)(n.z,{variant:"outline",onClick:()=>b.push("/settings"),children:[(0,l.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"设置"]}),(0,l.jsx)(n.z,{variant:"outline",onClick:S,children:"退出登录"})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,l.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,l.jsxs)(i.Zb,{children:[(0,l.jsx)(i.Ol,{children:(0,l.jsxs)(i.ll,{className:"flex items-center",children:[(0,l.jsx)(o.Z,{className:"h-5 w-5 mr-2"}),"个人资料"]})}),(0,l.jsxs)(i.aY,{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)(d.Avatar,{className:"h-16 w-16",children:[(0,l.jsx)(d.AvatarImage,{src:k.avatar_url}),(0,l.jsx)(d.AvatarFallback,{children:null===(e=k.full_name)||void 0===e?void 0:e.charAt(0).toUpperCase()})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-semibold",children:k.full_name}),(0,l.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:k.email}),k.location&&(0,l.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center",children:[(0,l.jsx)(u.Z,{className:"h-3 w-3 mr-1"}),k.location]})]})]}),k.bio&&(0,l.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:k.bio}),k.interests.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium mb-2",children:"兴趣爱好"}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[k.interests.slice(0,5).map((e,s)=>(0,l.jsx)(x.C,{variant:"secondary",className:"text-xs",children:e},s)),k.interests.length>5&&(0,l.jsxs)(x.C,{variant:"outline",className:"text-xs",children:["+",k.interests.length-5]})]})]}),(0,l.jsx)(n.z,{variant:"outline",className:"w-full",onClick:()=>b.push("/profile/edit"),children:"编辑资料"})]})]}),(0,l.jsxs)(i.Zb,{children:[(0,l.jsx)(i.Ol,{children:(0,l.jsxs)(i.ll,{className:"flex items-center",children:[(0,l.jsx)(N.Z,{className:"h-5 w-5 mr-2"}),"积分余额"]})}),(0,l.jsx)(i.aY,{children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:k.credits}),(0,l.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"可用积分"}),(0,l.jsxs)(n.z,{onClick:()=>{b.push("/payment/recharge")},className:"w-full",children:[(0,l.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"充值积分"]})]})})]}),(0,l.jsxs)(i.Zb,{children:[(0,l.jsx)(i.Ol,{children:(0,l.jsx)(i.ll,{children:"快速操作"})}),(0,l.jsxs)(i.aY,{className:"space-y-3",children:[(0,l.jsxs)(n.z,{onClick:E,className:"w-full",children:[(0,l.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"开始匹配"]}),(0,l.jsxs)(n.z,{variant:"outline",onClick:M,className:"w-full",children:[(0,l.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"查看聊天"]}),(0,l.jsxs)(n.z,{variant:"outline",onClick:()=>b.push("/matching/history"),className:"w-full",children:[(0,l.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"匹配历史"]})]})]})]}),(0,l.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[z&&(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,l.jsx)(i.Zb,{children:(0,l.jsx)(i.aY,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(f.Z,{className:"h-8 w-8 text-red-500 mr-3"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"总匹配数"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:z.totalMatches})]})]})})}),(0,l.jsx)(i.Zb,{children:(0,l.jsx)(i.aY,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(h.Z,{className:"h-8 w-8 text-blue-500 mr-3"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"消息数量"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:z.totalMessages})]})]})})}),(0,l.jsx)(i.Zb,{children:(0,l.jsx)(i.aY,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(g.Z,{className:"h-8 w-8 text-green-500 mr-3"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"活跃聊天"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:z.activeChats})]})]})})}),(0,l.jsx)(i.Zb,{children:(0,l.jsx)(i.aY,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(v.Z,{className:"h-8 w-8 text-purple-500 mr-3"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"资料完整度"}),(0,l.jsxs)("p",{className:"text-2xl font-bold",children:[z.profileCompletion,"%"]})]})]})})})]}),(0,l.jsxs)(i.Zb,{children:[(0,l.jsxs)(i.Ol,{children:[(0,l.jsxs)(i.ll,{className:"flex items-center justify-between",children:[(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(f.Z,{className:"h-5 w-5 mr-2"}),"最近匹配"]}),(0,l.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>b.push("/matching/history"),children:"查看全部"})]}),(0,l.jsx)(i.SZ,{children:"您最近的匹配对象"})]}),(0,l.jsx)(i.aY,{children:0===C.length?(0,l.jsxs)("div",{className:"text-center py-8",children:[(0,l.jsx)(f.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"还没有匹配记录"}),(0,l.jsx)(n.z,{onClick:E,children:"开始匹配"})]}):(0,l.jsx)("div",{className:"space-y-4",children:C.map(e=>{var s;return(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors cursor-pointer",onClick:()=>b.push("/chat/".concat(e.id)),children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsxs)(d.Avatar,{children:[(0,l.jsx)(d.AvatarImage,{src:e.matched_user.avatar_url}),(0,l.jsx)(d.AvatarFallback,{children:null===(s=e.matched_user.full_name)||void 0===s?void 0:s.charAt(0).toUpperCase()})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium",children:e.matched_user.full_name}),(0,l.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["匹配于 ",new Date(e.matched_at).toLocaleDateString()]})]})]}),(0,l.jsx)("div",{className:"text-right",children:(0,l.jsxs)(x.C,{variant:"secondary",children:[Math.round(100*e.compatibility_score),"% 匹配"]})})]},e.id)})})})]}),(0,l.jsxs)(i.Zb,{children:[(0,l.jsx)(i.Ol,{children:(0,l.jsxs)(i.ll,{className:"flex items-center",children:[(0,l.jsx)(y.Z,{className:"h-5 w-5 mr-2"}),"活动摘要"]})}),(0,l.jsx)(i.aY,{children:(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"本周新匹配"}),(0,l.jsx)("span",{className:"font-medium",children:C.filter(e=>new Date(e.matched_at)>new Date(Date.now()-6048e5)).length})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"活跃天数"}),(0,l.jsx)("span",{className:"font-medium",children:Math.floor((Date.now()-new Date(k.created_at).getTime())/864e5)})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"平均响应时间"}),(0,l.jsx)("span",{className:"font-medium",children:"2.3 小时"})]})]})})]})]})]})]})}):(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,l.jsxs)(i.Zb,{className:"w-full max-w-md",children:[(0,l.jsxs)(i.Ol,{children:[(0,l.jsx)(i.ll,{children:"用户资料未找到"}),(0,l.jsx)(i.SZ,{children:"请完善您的个人资料"})]}),(0,l.jsx)(i.aY,{children:(0,l.jsx)(n.z,{onClick:()=>b.push("/profile/setup"),className:"w-full",children:"设置个人资料"})})]})})}}},function(e){e.O(0,[216,930,744],function(){return e(e.s=261)}),_N_E=e.O()}]);