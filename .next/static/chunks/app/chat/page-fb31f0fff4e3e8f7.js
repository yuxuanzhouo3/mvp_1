(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{8087:function(e,t,s){Promise.resolve().then(s.bind(s,3570))},3570:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var r=s(7437),a=s(2265),n=s(4033),l=s(4620),i=s(9598),c=s(3611),d=s(5831),o=s(7702),u=s(708),x=s(446),m=s(9883),f=s(1827),h=s(2882),g=s(7810),p=s(2741),j=s(8339),v=s(290);function N(){let e=(0,n.useRouter)(),{user:t}=(0,l.a)(),{toast:s}=(0,x.p)(),[N,b]=(0,a.useState)([]),[y,w]=(0,a.useState)([]),[_,k]=(0,a.useState)(""),[C,z]=(0,a.useState)(!0),[Z,R]=(0,a.useState)("all");(0,a.useEffect)(()=>{if(!t){e.push("/auth/login");return}D()},[t]),(0,a.useEffect)(()=>{E()},[N,_,Z]);let D=async()=>{try{z(!0);let e=await fetch("/api/chat/list");if(e.ok){let t=await e.json();b(t.chats)}}catch(e){s({title:"加载失败",description:"无法加载聊天列表",variant:"destructive"})}finally{z(!1)}},E=()=>{let e=N;switch(_&&(e=e.filter(e=>e.matched_user.full_name.toLowerCase().includes(_.toLowerCase()))),Z){case"unread":e=e.filter(e=>e.unread_count>0);break;case"online":e=e.filter(e=>e.matched_user.is_online)}w(e)},S=t=>{e.push("/chat/".concat(t))},Y=()=>{e.push("/matching")},F=e=>"image"===e.message_type?"\uD83D\uDCF7 图片":"file"===e.message_type?"\uD83D\uDCCE 文件":e.content.length>30?e.content.substring(0,30)+"...":e.content,q=e=>{let t=new Date(e),s=new Date,r=(s.getTime()-t.getTime())/36e5;return r<1?"刚刚":r<24?"".concat(Math.floor(r),"小时前"):t.toLocaleDateString("zh-CN")};return C?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"加载聊天列表中..."})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"聊天"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"与您的匹配对象保持联系"})]}),(0,r.jsxs)(c.z,{onClick:Y,children:[(0,r.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"开始匹配"]})]}),(0,r.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(f.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,r.jsx)(d.I,{placeholder:"搜索聊天...",value:_,onChange:e=>k(e.target.value),className:"pl-10"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(c.z,{variant:"all"===Z?"default":"outline",size:"sm",onClick:()=>R("all"),children:"全部"}),(0,r.jsx)(c.z,{variant:"unread"===Z?"default":"outline",size:"sm",onClick:()=>R("unread"),children:"未读"}),(0,r.jsx)(c.z,{variant:"online"===Z?"default":"outline",size:"sm",onClick:()=>R("online"),children:"在线"})]})]}),0===y.length?(0,r.jsx)(i.Zb,{children:(0,r.jsxs)(i.aY,{className:"text-center py-12",children:[(0,r.jsx)(h.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:_?"没有找到匹配的聊天":"还没有聊天"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:_?"尝试调整搜索条件":"开始匹配来找到新的朋友并开始聊天"}),!_&&(0,r.jsxs)(c.z,{onClick:Y,children:[(0,r.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"开始匹配"]})]})}):(0,r.jsx)("div",{className:"space-y-4",children:y.map(e=>{var t;return(0,r.jsx)(i.Zb,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>S(e.id),children:(0,r.jsx)(i.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)(o.qE,{className:"h-12 w-12",children:[(0,r.jsx)(o.F$,{src:e.matched_user.avatar_url}),(0,r.jsx)(o.Q5,{children:null===(t=e.matched_user.full_name)||void 0===t?void 0:t.charAt(0).toUpperCase()})]}),(0,r.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white dark:border-gray-800 ".concat(e.matched_user.is_online?"bg-green-500":"bg-gray-400")})]}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.matched_user.full_name}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)(u.C,{variant:"secondary",className:"text-xs",children:[Math.round(100*e.compatibility_score),"% 匹配"]}),(0,r.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:q(e.last_message.created_at)})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:F(e.last_message)}),e.unread_count>0&&(0,r.jsx)(u.C,{variant:"destructive",className:"text-xs",children:e.unread_count})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(c.z,{variant:"ghost",size:"sm",children:(0,r.jsx)(p.Z,{className:"h-4 w-4"})}),(0,r.jsx)(c.z,{variant:"ghost",size:"sm",children:(0,r.jsx)(j.Z,{className:"h-4 w-4"})}),(0,r.jsx)(c.z,{variant:"ghost",size:"sm",children:(0,r.jsx)(v.Z,{className:"h-4 w-4"})})]})]})})},e.id)})}),N.length>0&&(0,r.jsx)("div",{className:"mt-8",children:(0,r.jsx)(i.Zb,{children:(0,r.jsx)(i.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-600 dark:text-gray-400",children:[(0,r.jsxs)("span",{children:["总计 ",N.length," 个聊天"]}),(0,r.jsxs)("span",{children:[N.filter(e=>e.unread_count>0).length," 个未读"]}),(0,r.jsxs)("span",{children:[N.filter(e=>e.matched_user.is_online).length," 个在线"]})]})})})})]})})}},7702:function(e,t,s){"use strict";s.d(t,{F$:function(){return c},Q5:function(){return d},qE:function(){return i}});var r=s(7437),a=s(2265),n=s(1465),l=s(1628);let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.fC,{ref:t,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a})});i.displayName=n.fC.displayName;let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.Ee,{ref:t,className:(0,l.cn)("aspect-square h-full w-full",s),...a})});c.displayName=n.Ee.displayName;let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.NY,{ref:t,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a})});d.displayName=n.NY.displayName},708:function(e,t,s){"use strict";s.d(t,{C:function(){return i}});var r=s(7437);s(2265);var a=s(6061),n=s(1628);let l=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)(l({variant:s}),t),...a})}},9598:function(e,t,s){"use strict";s.d(t,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return l},aY:function(){return o},ll:function(){return c}});var r=s(7437),a=s(2265),n=s(1628);let l=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});l.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...a})});i.displayName="CardHeader";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})});c.displayName="CardTitle";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...a})});d.displayName="CardDescription";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...a})});o.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...a})});u.displayName="CardFooter"},5831:function(e,t,s){"use strict";s.d(t,{I:function(){return l}});var r=s(7437),a=s(2265),n=s(1628);let l=a.forwardRef((e,t)=>{let{className:s,type:a,label:l,error:i,icon:c,description:d,...o}=e;return(0,r.jsxs)("div",{className:"w-full space-y-1",children:[l&&(0,r.jsx)("label",{className:"block text-sm font-medium text-foreground",children:l}),(0,r.jsxs)("div",{className:"relative",children:[c&&(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:c}),(0,r.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background","file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50",c?"pl-10":"",i?"border-destructive focus-visible:ring-destructive/30":"",s),ref:t,...o})]}),d&&!i&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:d}),i&&(0,r.jsx)("p",{className:"text-xs text-destructive",children:i})]})});l.displayName="Input"},446:function(e,t,s){"use strict";s.d(t,{p:function(){return a}});var r=s(1271);let a=r.pm}},function(e){e.O(0,[216,689,744],function(){return e(e.s=8087)}),_N_E=e.O()}]);