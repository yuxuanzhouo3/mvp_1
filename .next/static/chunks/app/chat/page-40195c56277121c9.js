(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{8087:function(e,s,t){Promise.resolve().then(t.bind(t,3570))},3570:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return p}});var a=t(7437),r=t(2265),l=t(4033),n=t(4620),i=t(9598),c=t(3611),d=t(5831),x=t(7702),m=t(708),u=t(446),o=t(9883),h=t(1827),f=t(2882),j=t(7810),g=t(2741),v=t(8339),b=t(290);function p(){let e=(0,l.useRouter)(),{user:s}=(0,n.a)(),{toast:t}=(0,u.p)(),[p,N]=(0,r.useState)([]),[y,w]=(0,r.useState)([]),[_,k]=(0,r.useState)(""),[C,z]=(0,r.useState)(!0),[Z,D]=(0,r.useState)("all");(0,r.useEffect)(()=>{if(!s){e.push("/auth/login");return}E()},[s]),(0,r.useEffect)(()=>{S()},[p,_,Z]);let E=async()=>{try{z(!0);let e=await fetch("/api/chat/list");if(e.ok){let s=await e.json();N(s.chats)}}catch(e){t({title:"加载失败",description:"无法加载聊天列表",variant:"destructive"})}finally{z(!1)}},S=()=>{let e=p;switch(_&&(e=e.filter(e=>e.matched_user.full_name.toLowerCase().includes(_.toLowerCase()))),Z){case"unread":e=e.filter(e=>e.unread_count>0);break;case"online":e=e.filter(e=>e.matched_user.is_online)}w(e)},A=s=>{e.push("/chat/".concat(s))},I=()=>{e.push("/matching")},L=e=>"image"===e.message_type?"\uD83D\uDCF7 图片":"file"===e.message_type?"\uD83D\uDCCE 文件":e.content.length>30?e.content.substring(0,30)+"...":e.content,Y=e=>{let s=new Date(e),t=new Date,a=(t.getTime()-s.getTime())/36e5;return a<1?"刚刚":a<24?"".concat(Math.floor(a),"小时前"):s.toLocaleDateString("zh-CN")};return C?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"加载聊天列表中..."})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"聊天"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"与您的匹配对象保持联系"})]}),(0,a.jsxs)(c.z,{onClick:I,children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"开始匹配"]})]}),(0,a.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)(d.I,{placeholder:"搜索聊天...",value:_,onChange:e=>k(e.target.value),className:"pl-10"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.z,{variant:"all"===Z?"default":"outline",size:"sm",onClick:()=>D("all"),children:"全部"}),(0,a.jsx)(c.z,{variant:"unread"===Z?"default":"outline",size:"sm",onClick:()=>D("unread"),children:"未读"}),(0,a.jsx)(c.z,{variant:"online"===Z?"default":"outline",size:"sm",onClick:()=>D("online"),children:"在线"})]})]}),0===y.length?(0,a.jsx)(i.Zb,{children:(0,a.jsxs)(i.aY,{className:"text-center py-12",children:[(0,a.jsx)(f.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:_?"没有找到匹配的聊天":"还没有聊天"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:_?"尝试调整搜索条件":"开始匹配来找到新的朋友并开始聊天"}),!_&&(0,a.jsxs)(c.z,{onClick:I,children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"开始匹配"]})]})}):(0,a.jsx)("div",{className:"space-y-4",children:y.map(e=>{var s;return(0,a.jsx)(i.Zb,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>A(e.id),children:(0,a.jsx)(i.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(x.Avatar,{className:"h-12 w-12",children:[(0,a.jsx)(x.AvatarImage,{src:e.matched_user.avatar_url}),(0,a.jsx)(x.AvatarFallback,{children:null===(s=e.matched_user.full_name)||void 0===s?void 0:s.charAt(0).toUpperCase()})]}),(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white dark:border-gray-800 ".concat(e.matched_user.is_online?"bg-green-500":"bg-gray-400")})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.matched_user.full_name}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(m.C,{variant:"secondary",className:"text-xs",children:[Math.round(100*e.compatibility_score),"% 匹配"]}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:Y(e.last_message.created_at)})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:L(e.last_message)}),e.unread_count>0&&(0,a.jsx)(m.C,{variant:"destructive",className:"text-xs",children:e.unread_count})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(c.z,{variant:"ghost",size:"sm",children:(0,a.jsx)(g.Z,{className:"h-4 w-4"})}),(0,a.jsx)(c.z,{variant:"ghost",size:"sm",children:(0,a.jsx)(v.Z,{className:"h-4 w-4"})}),(0,a.jsx)(c.z,{variant:"ghost",size:"sm",children:(0,a.jsx)(b.Z,{className:"h-4 w-4"})})]})]})})},e.id)})}),p.length>0&&(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-600 dark:text-gray-400",children:[(0,a.jsxs)("span",{children:["总计 ",p.length," 个聊天"]}),(0,a.jsxs)("span",{children:[p.filter(e=>e.unread_count>0).length," 个未读"]}),(0,a.jsxs)("span",{children:[p.filter(e=>e.matched_user.is_online).length," 个在线"]})]})})})})]})})}},5831:function(e,s,t){"use strict";t.d(s,{I:function(){return n}});var a=t(7437),r=t(2265),l=t(1628);let n=r.forwardRef((e,s)=>{let{className:t,type:r,label:n,error:i,icon:c,description:d,...x}=e;return(0,a.jsxs)("div",{className:"w-full space-y-1",children:[n&&(0,a.jsx)("label",{className:"block text-sm font-medium text-foreground",children:n}),(0,a.jsxs)("div",{className:"relative",children:[c&&(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:c}),(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background","file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50",c?"pl-10":"",i?"border-destructive focus-visible:ring-destructive/30":"",t),ref:s,...x})]}),d&&!i&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:d}),i&&(0,a.jsx)("p",{className:"text-xs text-destructive",children:i})]})});n.displayName="Input"}},function(e){e.O(0,[216,930,744],function(){return e(e.s=8087)}),_N_E=e.O()}]);