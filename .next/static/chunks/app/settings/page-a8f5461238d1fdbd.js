(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{5623:function(e,t,s){Promise.resolve().then(s.bind(s,703))},4620:function(e,t,s){"use strict";s.d(t,{H:function(){return c},a:function(){return d}});var r=s(7437),n=s(2265),a=s(1492);let i=null,l=(0,n.createContext)(void 0);function c(e){let{children:t}=e,[s,c]=(0,n.useState)(null),[d,o]=(0,n.useState)(null),[u,f]=(0,n.useState)(!0),h=(0,n.useRef)(!1),m=(0,n.useRef)(null),x=function(){if(!i){let e="https://bamratexknmqvdbalzen.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJhbXJhdGV4a25tcXZkYmFsemVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MTM4NzEsImV4cCI6MjA2ODA4OTg3MX0.yYa98ioJLLouUgHWITGb7U_VjNCTUuM-5NcraM7f3zA";if(!e||!t)throw Error("Missing Supabase environment variables");i=(0,a.eI)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:window.localStorage}})}return i}();(0,n.useEffect)(()=>{if(h.current)return;h.current=!0;let e=async()=>{try{let{data:{session:e},error:t}=await x.auth.getSession();t||e&&(o(e),c(e.user),m.current=e.user)}catch(e){}finally{f(!1)}};e();let{data:{subscription:t}}=x.auth.onAuthStateChange(async(e,t)=>{f(!0);try{"SIGNED_IN"===e&&t?(o(t),c(t.user),m.current=t.user):"SIGNED_OUT"===e?(o(null),c(null),m.current=null):"TOKEN_REFRESHED"===e&&t?(o(t),c(t.user)):"INITIAL_SESSION"===e&&(t?(o(t),c(t.user),m.current=t.user):(o(null),c(null),m.current=null))}catch(e){}finally{f(!1)}});return()=>{t.unsubscribe()}},[]);let p=(0,n.useCallback)(async(e,t)=>{let{error:s}=await x.auth.signInWithPassword({email:e,password:t});return{error:s}},[]),g=(0,n.useCallback)(async()=>{let{error:e}=await x.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});return{error:e}},[]),b=(0,n.useCallback)(async e=>{let{error:t}=await x.auth.signInWithOtp({phone:e});return{error:t}},[]),v=(0,n.useCallback)(async(e,t)=>{let{error:s}=await x.auth.verifyOtp({phone:e,token:t,type:"sms"});return{error:s}},[]),j=(0,n.useCallback)(async(e,t)=>{let{error:s}=await x.auth.signUp({email:e,password:t});return{error:s}},[]),N=(0,n.useCallback)(async()=>{try{let{error:e}=await x.auth.signOut();if(e)throw e;o(null),c(null),m.current=null,localStorage.removeItem("supabase.auth.token"),localStorage.removeItem("supabase.auth.expires_at"),localStorage.removeItem("supabase.auth.refresh_token")}catch(e){throw e}},[]);return(0,r.jsx)(l.Provider,{value:{user:s,session:d,loading:u,signIn:p,signInWithGoogle:g,signInWithPhone:b,verifyPhoneOTP:v,signUp:j,signOut:N},children:t})}function d(){let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},703:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var r=s(7437),n=s(2265),a=s(4033),i=s(4620),l=s(9598),c=s(3611),d=s(5831),o=s(453),u=s(446),f=s(7972),h=s(3021),m=s(9036),x=s(1738),p=s(8956);function g(){var e;let t=(0,a.useRouter)(),{user:s,signOut:g}=(0,i.a)(),{toast:b}=(0,u.p)(),[v,j]=(0,n.useState)({notifications:!0,emailUpdates:!0,darkMode:!1,language:"zh-CN"}),[N,y]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(!s){t.push("/auth/login");return}},[s,t]);let w=(e,t)=>{j(s=>({...s,[e]:t}))},k=async()=>{y(!0);try{let e=await fetch("/api/user/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});e.ok&&b({title:"设置已保存",description:"您的设置已成功更新"})}catch(e){b({title:"保存失败",description:"无法保存设置，请稍后重试",variant:"destructive"})}finally{y(!1)}},I=async()=>{await g(),t.push("/")};return s?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"设置"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"管理您的账户设置和偏好"})]}),(0,r.jsxs)("div",{className:"grid gap-6",children:[(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsxs)(l.ll,{className:"flex items-center",children:[(0,r.jsx)(f.Z,{className:"h-5 w-5 mr-2"}),"个人资料"]})}),(0,r.jsxs)(l.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"显示名称"}),(0,r.jsx)(d.I,{defaultValue:(null===(e=s.user_metadata)||void 0===e?void 0:e.full_name)||"",placeholder:"输入显示名称"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"邮箱"}),(0,r.jsx)(d.I,{defaultValue:s.email||"",disabled:!0,className:"bg-gray-50"})]})]}),(0,r.jsx)(c.z,{onClick:()=>t.push("/profile/edit"),children:"编辑完整资料"})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsxs)(l.ll,{className:"flex items-center",children:[(0,r.jsx)(h.Z,{className:"h-5 w-5 mr-2"}),"通知设置"]})}),(0,r.jsxs)(l.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:"推送通知"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"接收新消息和匹配通知"})]}),(0,r.jsx)(o.r,{checked:v.notifications,onCheckedChange:e=>w("notifications",e)})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:"邮件更新"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"接收重要更新和活动通知"})]}),(0,r.jsx)(o.r,{checked:v.emailUpdates,onCheckedChange:e=>w("emailUpdates",e)})]})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsxs)(l.ll,{className:"flex items-center",children:[(0,r.jsx)(m.Z,{className:"h-5 w-5 mr-2"}),"隐私设置"]})}),(0,r.jsxs)(l.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:"在线状态"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"允许其他用户看到您的在线状态"})]}),(0,r.jsx)(o.r,{defaultChecked:!0})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:"位置信息"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"在匹配中显示您的位置"})]}),(0,r.jsx)(o.r,{defaultChecked:!0})]})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsxs)(l.ll,{className:"flex items-center",children:[(0,r.jsx)(x.Z,{className:"h-5 w-5 mr-2"}),"支付设置"]})}),(0,r.jsx)(l.aY,{children:(0,r.jsx)(c.z,{variant:"outline",onClick:()=>t.push("/payment/recharge"),children:"管理支付方式"})})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsxs)(l.ll,{className:"flex items-center",children:[(0,r.jsx)(p.Z,{className:"h-5 w-5 mr-2"}),"语言设置"]})}),(0,r.jsx)(l.aY,{children:(0,r.jsxs)("select",{value:v.language,onChange:e=>w("language",e.target.value),className:"w-full p-2 border rounded-md",children:[(0,r.jsx)("option",{value:"zh-CN",children:"中文 (简体)"}),(0,r.jsx)("option",{value:"en-US",children:"English (US)"}),(0,r.jsx)("option",{value:"ja-JP",children:"日本語"})]})})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(c.z,{variant:"outline",onClick:()=>t.push("/dashboard"),children:"返回仪表盘"}),(0,r.jsxs)("div",{className:"space-x-2",children:[(0,r.jsx)(c.z,{variant:"outline",onClick:k,disabled:N,children:N?"保存中...":"保存设置"}),(0,r.jsx)(c.z,{variant:"destructive",onClick:I,children:"退出登录"})]})]})]})]})}):null}},3611:function(e,t,s){"use strict";s.d(t,{z:function(){return d}});var r=s(7437),n=s(2265),a=s(7256),i=s(6061),l=s(1628);let c=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,t)=>{let{className:s,variant:n,size:i,asChild:d=!1,...o}=e,u=d?a.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(c({variant:n,size:i,className:s})),ref:t,...o})});d.displayName="Button"},9598:function(e,t,s){"use strict";s.d(t,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return i},aY:function(){return o},ll:function(){return c}});var r=s(7437),n=s(2265),a=s(1628);let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});i.displayName="Card";let l=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",s),...n})});l.displayName="CardHeader";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",s),...n})});c.displayName="CardTitle";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",s),...n})});d.displayName="CardDescription";let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",s),...n})});o.displayName="CardContent";let u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",s),...n})});u.displayName="CardFooter"},5831:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var r=s(7437),n=s(2265),a=s(1628);let i=n.forwardRef((e,t)=>{let{className:s,type:n,label:i,error:l,icon:c,description:d,...o}=e;return(0,r.jsxs)("div",{className:"w-full space-y-1",children:[i&&(0,r.jsx)("label",{className:"block text-sm font-medium text-foreground",children:i}),(0,r.jsxs)("div",{className:"relative",children:[c&&(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:c}),(0,r.jsx)("input",{type:n,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background","file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50",c?"pl-10":"",l?"border-destructive focus-visible:ring-destructive/30":"",s),ref:t,...o})]}),d&&!l&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:d}),l&&(0,r.jsx)("p",{className:"text-xs text-destructive",children:l})]})});i.displayName="Input"},453:function(e,t,s){"use strict";s.d(t,{r:function(){return l}});var r=s(7437),n=s(2265),a=s(2376),i=s(1628);let l=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.fC,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background","disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...n,ref:t,children:(0,r.jsx)(a.bU,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform","data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});l.displayName=a.fC.displayName},1271:function(e,t,s){"use strict";s.d(t,{pm:function(){return f}});var r=s(2265);let n=0,a=new Map,i=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?i(s):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],d={toasts:[]};function o(e){d=l(d,e),c.forEach(e=>{e(d)})}function u(e){let{...t}=e,s=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>o({type:"DISMISS_TOAST",toastId:s});return o({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||r()}}}),{id:s,dismiss:r,update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function f(){let[e,t]=r.useState(d);return r.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>o({type:"DISMISS_TOAST",toastId:e})}}},446:function(e,t,s){"use strict";s.d(t,{p:function(){return n}});var r=s(1271);let n=r.pm},1628:function(e,t,s){"use strict";s.d(t,{cn:function(){return a}});var r=s(7042),n=s(4769);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.m6)((0,r.W)(t))}}},function(e){e.O(0,[216,744],function(){return e(e.s=5623)}),_N_E=e.O()}]);