(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[849],{9736:function(e,t,s){Promise.resolve().then(s.bind(s,8651))},8651:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var a=s(7437),l=s(2265),i=s(4033),r=s(4620),n=s(9598),c=s(3611),d=s(708),m=s(7702),x=s(446),h=s(7810),o=s(4280),u=s(2482),j=s(6142),p=s(5340),f=s(2549);function g(){var e;let t=(0,i.useRouter)(),{user:s}=(0,r.a)(),{toast:g}=(0,x.p)(),[N,v]=(0,l.useState)([]),[b,y]=(0,l.useState)(0),[w,k]=(0,l.useState)(!0),[C,_]=(0,l.useState)(!1),[z,S]=(0,l.useState)(!1),[Z,A]=(0,l.useState)({minAge:18,maxAge:65,location:"",interests:[]}),O=(0,l.useRef)(null);(0,l.useEffect)(()=>{if(!s){t.push("/auth/login");return}T()},[s]);let T=async()=>{try{k(!0);let e=await fetch("/api/matching/candidates");if(e.ok){let t=await e.json();v(t.candidates)}}catch(e){g({title:"加载失败",description:"无法加载匹配候选人",variant:"destructive"})}finally{k(!1)}},I=async()=>{if(C||b>=N.length)return;_(!0);let e=N[b];try{let s=await fetch("/api/matching/like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidateId:e.id})});if(s.ok){let a=await s.json();a.isMatch?(g({title:"\uD83C\uDF89 匹配成功！",description:"您与 ".concat(e.full_name," 互相喜欢！")}),setTimeout(()=>{t.push("/chat/".concat(a.chatId))},2e3)):g({title:"已喜欢",description:"您喜欢了 ".concat(e.full_name)})}}catch(e){g({title:"操作失败",description:"请稍后重试",variant:"destructive"})}finally{_(!1),y(e=>e+1)}},D=async()=>{if(C||b>=N.length)return;_(!0);let e=N[b];try{await fetch("/api/matching/pass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidateId:e.id})}),g({title:"已跳过",description:"您跳过了 ".concat(e.full_name)})}catch(e){g({title:"操作失败",description:"请稍后重试",variant:"destructive"})}finally{_(!1),y(e=>e+1)}},E=async()=>{if(C||b>=N.length)return;_(!0);let e=N[b];try{let s=await fetch("/api/matching/super-like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidateId:e.id})});if(s.ok){let a=await s.json();a.isMatch?(g({title:"\uD83C\uDF1F 超级匹配！",description:"您与 ".concat(e.full_name," 超级匹配！")}),setTimeout(()=>{t.push("/chat/".concat(a.chatId))},2e3)):g({title:"超级喜欢已发送",description:"您超级喜欢了 ".concat(e.full_name)})}}catch(e){g({title:"操作失败",description:"请稍后重试",variant:"destructive"})}finally{_(!1),y(e=>e+1)}},F=()=>{y(0),T()};if(w)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"正在寻找匹配..."})]})});if(0===N.length||b>=N.length)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,a.jsx)(n.Zb,{className:"w-full max-w-md",children:(0,a.jsxs)(n.aY,{className:"text-center py-12",children:[(0,a.jsx)(h.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"暂时没有更多推荐"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"我们已经为您展示了所有可用的匹配。请稍后再来查看新的推荐！"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)(c.z,{onClick:F,className:"w-full",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"刷新推荐"]}),(0,a.jsx)(c.z,{variant:"outline",onClick:()=>t.push("/dashboard"),className:"w-full",children:"返回仪表盘"})]})]})})});let P=N[b];return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"发现"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"找到您的理想匹配"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>S(!z),children:(0,a.jsx)(u.Z,{className:"h-4 w-4"})}),(0,a.jsx)(c.z,{variant:"outline",size:"sm",onClick:F,children:(0,a.jsx)(o.Z,{className:"h-4 w-4"})})]})]}),z&&(0,a.jsxs)(n.Zb,{className:"mb-6",children:[(0,a.jsx)(n.Ol,{children:(0,a.jsx)(n.ll,{className:"text-lg",children:"筛选条件"})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"年龄范围"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,a.jsx)("input",{type:"number",value:Z.minAge,onChange:e=>A(t=>({...t,minAge:parseInt(e.target.value)})),className:"w-20 px-2 py-1 border rounded text-sm",min:"18",max:"100"}),(0,a.jsx)("span",{children:"至"}),(0,a.jsx)("input",{type:"number",value:Z.maxAge,onChange:e=>A(t=>({...t,maxAge:parseInt(e.target.value)})),className:"w-20 px-2 py-1 border rounded text-sm",min:"18",max:"100"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"位置"}),(0,a.jsx)("input",{type:"text",value:Z.location,onChange:e=>A(t=>({...t,location:e.target.value})),placeholder:"输入城市名称",className:"w-full px-3 py-2 border rounded mt-1"})]})]})]}),(0,a.jsx)(n.Zb,{ref:O,className:"relative overflow-hidden cursor-pointer transition-transform hover:scale-105",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"aspect-square bg-gradient-to-br from-blue-400 to-purple-600 relative",children:[P.avatar_url?(0,a.jsx)("img",{src:P.avatar_url,alt:P.full_name,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)(m.Avatar,{className:"h-32 w-32",children:(0,a.jsx)(m.AvatarFallback,{className:"text-4xl",children:null===(e=P.full_name)||void 0===e?void 0:e.charAt(0).toUpperCase()})})}),(0,a.jsx)("div",{className:"absolute top-4 right-4",children:(0,a.jsxs)(d.C,{className:"bg-white/90 text-gray-900",children:[Math.round(100*P.compatibility_score),"% 匹配"]})})]}),(0,a.jsxs)(n.aY,{className:"p-6",children:[(0,a.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[P.full_name,", ",P.age]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-gray-600 dark:text-gray-400",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:P.location})]})]})}),(0,a.jsx)("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:P.bio}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"兴趣爱好"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[P.interests.slice(0,5).map((e,t)=>(0,a.jsx)(d.C,{variant:"secondary",className:"text-xs",children:e},t)),P.interests.length>5&&(0,a.jsxs)(d.C,{variant:"outline",className:"text-xs",children:["+",P.interests.length-5]})]})]}),P.common_interests.length>0&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-green-600 mb-2",children:"共同兴趣"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:P.common_interests.map((e,t)=>(0,a.jsx)(d.C,{className:"bg-green-100 text-green-800 text-xs",children:e},t))})]}),P.match_reasons.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-blue-600 mb-2",children:"匹配理由"}),(0,a.jsx)("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:P.match_reasons.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(p.Z,{className:"h-3 w-3 text-blue-500 mr-2"}),e]},t))})]})]})]})}),(0,a.jsxs)("div",{className:"flex justify-center items-center space-x-4 mt-6",children:[(0,a.jsx)(c.z,{variant:"outline",size:"lg",onClick:D,disabled:C,className:"w-16 h-16 rounded-full border-2 border-gray-300 hover:border-red-500 hover:bg-red-50",children:(0,a.jsx)(f.Z,{className:"h-8 w-8 text-gray-600"})}),(0,a.jsx)(c.z,{variant:"outline",size:"lg",onClick:E,disabled:C,className:"w-16 h-16 rounded-full border-2 border-purple-300 hover:border-purple-500 hover:bg-purple-50",children:(0,a.jsx)(p.Z,{className:"h-8 w-8 text-purple-600"})}),(0,a.jsx)(c.z,{size:"lg",onClick:I,disabled:C,className:"w-16 h-16 rounded-full bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600",children:(0,a.jsx)(h.Z,{className:"h-8 w-8 text-white"})})]}),(0,a.jsx)("div",{className:"mt-6 text-center",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[b+1," / ",N.length]})})]})})}}},function(e){e.O(0,[216,930,744],function(){return e(e.s=9736)}),_N_E=e.O()}]);