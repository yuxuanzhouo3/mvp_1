(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[849],{9736:function(e,t,a){Promise.resolve().then(a.bind(a,8651))},8651:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var s=a(7437),r=a(2265),n=a(4033),l=a(4620),i=a(9598),c=a(3611),d=a(708),o=a(7702),m=a(446),u=a(7810),x=a(4280),h=a(2482),f=a(7972),p=a(6142),g=a(5340),j=a(2549);function N(){var e;let t=(0,n.useRouter)(),{user:N}=(0,l.a)(),{toast:v}=(0,m.p)(),[y,b]=(0,r.useState)([]),[w,k]=(0,r.useState)(0),[C,I]=(0,r.useState)(!0),[_,z]=(0,r.useState)(!1),[Z,S]=(0,r.useState)(!1),[O,T]=(0,r.useState)({minAge:18,maxAge:65,location:"",interests:[]}),J=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(!N){t.push("/auth/login");return}R()},[N]);let R=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{I(!0);let{createClient:t}=await Promise.resolve().then(a.bind(a,1492)),s=t("https://bamratexknmqvdbalzen.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJhbXJhdGV4a25tcXZkYmFsemVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MTM4NzEsImV4cCI6MjA2ODA4OTg3MX0.yYa98ioJLLouUgHWITGb7U_VjNCTUuM-5NcraM7f3zA"),{data:{session:r}}=await s.auth.getSession();if(!(null==r?void 0:r.access_token))return;let n={Authorization:"Bearer ".concat(r.access_token),"Content-Type":"application/json"},l=e?"/api/matching/candidates?refresh=true&t=".concat(Date.now()):"/api/matching/candidates",i=await fetch(l,{headers:n});if(i.ok){let e=await i.json();b(e.candidates)}else v({title:"加载失败",description:"无法加载匹配候选人",variant:"destructive"})}catch(e){v({title:"加载失败",description:"无法加载匹配候选人",variant:"destructive"})}finally{I(!1)}},A=async()=>{if(_||w>=y.length)return;z(!0);let e=y[w];try{let a=await fetch("/api/matching/like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidateId:e.id})});if(a.ok){let s=await a.json();s.isMatch?(v({title:"\uD83C\uDF89 匹配成功！",description:"您与 ".concat(e.full_name," 互相喜欢！")}),setTimeout(()=>{t.push("/chat/".concat(s.chatId))},2e3)):v({title:"已喜欢",description:"您喜欢了 ".concat(e.full_name)})}}catch(e){v({title:"操作失败",description:"请稍后重试",variant:"destructive"})}finally{z(!1),k(e=>e+1)}},E=async()=>{if(_||w>=y.length)return;z(!0);let e=y[w];try{await fetch("/api/matching/pass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidateId:e.id})}),v({title:"已跳过",description:"您跳过了 ".concat(e.full_name)})}catch(e){v({title:"操作失败",description:"请稍后重试",variant:"destructive"})}finally{z(!1),k(e=>e+1)}},M=async()=>{if(_||w>=y.length)return;z(!0);let e=y[w];try{let a=await fetch("/api/matching/super-like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidateId:e.id})});if(a.ok){let s=await a.json();s.isMatch?(v({title:"\uD83C\uDF1F 超级匹配！",description:"您与 ".concat(e.full_name," 超级匹配！")}),setTimeout(()=>{t.push("/chat/".concat(s.chatId))},2e3)):v({title:"超级喜欢已发送",description:"您超级喜欢了 ".concat(e.full_name)})}}catch(e){v({title:"操作失败",description:"请稍后重试",variant:"destructive"})}finally{z(!1),k(e=>e+1)}},Y=()=>{k(0),R(!0)};if(C)return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"正在寻找匹配..."})]})});if(0===y.length||w>=y.length)return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,s.jsx)(i.Zb,{className:"w-full max-w-md",children:(0,s.jsxs)(i.aY,{className:"text-center py-12",children:[(0,s.jsx)(u.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"暂时没有更多推荐"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"我们已经为您展示了所有可用的匹配。请稍后再来查看新的推荐！"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)(c.z,{onClick:Y,className:"w-full",children:[(0,s.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"刷新推荐"]}),(0,s.jsx)(c.z,{variant:"outline",onClick:()=>t.push("/dashboard"),className:"w-full",children:"返回仪表盘"})]})]})})});let F=y[w];return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"发现"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"找到您的理想匹配"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>S(!Z),children:(0,s.jsx)(h.Z,{className:"h-4 w-4"})}),(0,s.jsx)(c.z,{variant:"outline",size:"sm",onClick:Y,children:(0,s.jsx)(x.Z,{className:"h-4 w-4"})}),(0,s.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>{t.push("/dashboard")},children:(0,s.jsx)(f.Z,{className:"h-4 w-4"})})]})]}),Z&&(0,s.jsxs)(i.Zb,{className:"mb-6",children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{className:"text-lg",children:"筛选条件"})}),(0,s.jsxs)(i.aY,{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"年龄范围"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,s.jsx)("input",{type:"number",value:O.minAge,onChange:e=>T(t=>({...t,minAge:parseInt(e.target.value)})),className:"w-20 px-2 py-1 border rounded text-sm",min:"18",max:"100"}),(0,s.jsx)("span",{children:"至"}),(0,s.jsx)("input",{type:"number",value:O.maxAge,onChange:e=>T(t=>({...t,maxAge:parseInt(e.target.value)})),className:"w-20 px-2 py-1 border rounded text-sm",min:"18",max:"100"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"位置"}),(0,s.jsx)("input",{type:"text",value:O.location,onChange:e=>T(t=>({...t,location:e.target.value})),placeholder:"输入城市名称",className:"w-full px-3 py-2 border rounded mt-1"})]})]})]}),(0,s.jsx)(i.Zb,{ref:J,className:"relative overflow-hidden cursor-pointer transition-transform hover:scale-105",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"aspect-square bg-gradient-to-br from-blue-400 to-purple-600 relative",children:[F.avatar_url?(0,s.jsx)("img",{src:F.avatar_url,alt:F.full_name,className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsx)(o.qE,{className:"h-32 w-32",children:(0,s.jsx)(o.Q5,{className:"text-4xl",children:null===(e=F.full_name)||void 0===e?void 0:e.charAt(0).toUpperCase()})})}),(0,s.jsx)("div",{className:"absolute top-4 right-4",children:(0,s.jsxs)(d.C,{className:"bg-white/90 text-gray-900",children:[Math.round(100*F.compatibility_score),"% 匹配"]})})]}),(0,s.jsxs)(i.aY,{className:"p-6",children:[(0,s.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[F.full_name,", ",F.age]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-gray-600 dark:text-gray-400",children:[(0,s.jsx)(p.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:F.location})]})]})}),(0,s.jsx)("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:F.bio}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"兴趣爱好"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[F.interests.slice(0,5).map((e,t)=>(0,s.jsx)(d.C,{variant:"secondary",className:"text-xs",children:e},t)),F.interests.length>5&&(0,s.jsxs)(d.C,{variant:"outline",className:"text-xs",children:["+",F.interests.length-5]})]})]}),F.common_interests.length>0&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-green-600 mb-2",children:"共同兴趣"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:F.common_interests.map((e,t)=>(0,s.jsx)(d.C,{className:"bg-green-100 text-green-800 text-xs",children:e},t))})]}),F.match_reasons.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-blue-600 mb-2",children:"匹配理由"}),(0,s.jsx)("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:F.match_reasons.map((e,t)=>(0,s.jsxs)("li",{className:"flex items-center",children:[(0,s.jsx)(g.Z,{className:"h-3 w-3 text-blue-500 mr-2"}),e]},t))})]})]})]})}),(0,s.jsxs)("div",{className:"flex justify-center items-center space-x-4 mt-6",children:[(0,s.jsx)(c.z,{variant:"outline",size:"lg",onClick:E,disabled:_,className:"w-16 h-16 rounded-full border-2 border-gray-300 hover:border-red-500 hover:bg-red-50",children:(0,s.jsx)(j.Z,{className:"h-8 w-8 text-gray-600"})}),(0,s.jsx)(c.z,{variant:"outline",size:"lg",onClick:M,disabled:_,className:"w-16 h-16 rounded-full border-2 border-purple-300 hover:border-purple-500 hover:bg-purple-50",children:(0,s.jsx)(g.Z,{className:"h-8 w-8 text-purple-600"})}),(0,s.jsx)(c.z,{size:"lg",onClick:A,disabled:_,className:"w-16 h-16 rounded-full bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600",children:(0,s.jsx)(u.Z,{className:"h-8 w-8 text-white"})})]}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[w+1," / ",y.length]})})]})})}},7702:function(e,t,a){"use strict";a.d(t,{F$:function(){return c},Q5:function(){return d},qE:function(){return i}});var s=a(7437),r=a(2265),n=a(1465),l=a(1628);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.fC,{ref:t,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...r})});i.displayName=n.fC.displayName;let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.Ee,{ref:t,className:(0,l.cn)("aspect-square h-full w-full",a),...r})});c.displayName=n.Ee.displayName;let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.NY,{ref:t,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...r})});d.displayName=n.NY.displayName},708:function(e,t,a){"use strict";a.d(t,{C:function(){return i}});var s=a(7437);a(2265);var r=a(6061),n=a(1628);let l=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{className:(0,n.cn)(l({variant:a}),t),...r})}},9598:function(e,t,a){"use strict";a.d(t,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return l},aY:function(){return o},ll:function(){return c}});var s=a(7437),r=a(2265),n=a(1628);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});l.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...r})});i.displayName="CardHeader";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});c.displayName="CardTitle";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})});d.displayName="CardDescription";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...r})});o.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...r})});m.displayName="CardFooter"},446:function(e,t,a){"use strict";a.d(t,{p:function(){return r}});var s=a(1271);let r=s.pm}},function(e){e.O(0,[216,689,744],function(){return e(e.s=9736)}),_N_E=e.O()}]);