(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[390],{1425:function(e,t,s){Promise.resolve().then(s.bind(s,4400))},4400:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var a=s(7437),r=s(2265),n=s(4033),l=s(4620),i=s(9598),c=s(3611),d=s(708),u=s(7702),o=s(446),m=s(3067),x=s(1827),f=s(7810),h=s(8203),v=s(6142),g=s(2882),j=s(1396),p=s.n(j),N=s(5831);function b(){let e=(0,n.useRouter)(),{user:t}=(0,l.a)(),{toast:s}=(0,o.p)(),[j,b]=(0,r.useState)([]),[y,w]=(0,r.useState)([]),[k,C]=(0,r.useState)(""),[_,R]=(0,r.useState)("all"),[Z,z]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!t){e.push("/auth/login");return}E()},[t]),(0,r.useEffect)(()=>{S()},[j,k,_]);let E=async()=>{try{z(!0);let e=await fetch("/api/user/matches");if(e.ok){let t=await e.json();b(t.matches)}}catch(e){s({title:"加载失败",description:"无法加载匹配历史",variant:"destructive"})}finally{z(!1)}},S=()=>{let e=j;switch(k&&(e=e.filter(e=>e.matched_user.full_name.toLowerCase().includes(k.toLowerCase())||e.matched_user.location.toLowerCase().includes(k.toLowerCase()))),_){case"active":e=e.filter(e=>"active"===e.status);break;case"inactive":e=e.filter(e=>"inactive"===e.status)}w(e)},L=t=>{e.push("/chat/".concat(t))},Y=e=>{let t=new Date(e);return t.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})},q=e=>{switch(e){case"active":return(0,a.jsx)(d.C,{variant:"default",className:"bg-green-100 text-green-800",children:"活跃"});case"inactive":return(0,a.jsx)(d.C,{variant:"secondary",children:"不活跃"});case"blocked":return(0,a.jsx)(d.C,{variant:"destructive",children:"已屏蔽"});default:return(0,a.jsx)(d.C,{variant:"outline",children:"未知"})}};return Z?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"加载匹配历史中..."})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"匹配历史"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"查看您的所有匹配记录"})]}),(0,a.jsx)(p(),{href:"/dashboard",children:(0,a.jsxs)(c.z,{variant:"outline",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"返回仪表盘"]})})]}),(0,a.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)(N.I,{placeholder:"搜索匹配...",value:k,onChange:e=>C(e.target.value),className:"pl-10"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(c.z,{variant:"all"===_?"default":"outline",size:"sm",onClick:()=>R("all"),children:["全部 (",j.length,")"]}),(0,a.jsxs)(c.z,{variant:"active"===_?"default":"outline",size:"sm",onClick:()=>R("active"),children:["活跃 (",j.filter(e=>"active"===e.status).length,")"]}),(0,a.jsxs)(c.z,{variant:"inactive"===_?"default":"outline",size:"sm",onClick:()=>R("inactive"),children:["不活跃 (",j.filter(e=>"inactive"===e.status).length,")"]})]})]}),(0,a.jsx)("div",{className:"grid gap-4",children:0===y.length?(0,a.jsx)(i.Zb,{children:(0,a.jsxs)(i.aY,{className:"text-center py-12",children:[(0,a.jsx)(f.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"暂无匹配记录"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:k||"all"!==_?"没有找到符合条件的匹配":"开始匹配来发现新的朋友吧！"}),!k&&"all"===_&&(0,a.jsx)(c.z,{onClick:()=>e.push("/matching"),children:"开始匹配"})]})}):y.map(e=>(0,a.jsx)(i.Zb,{className:"hover:shadow-md transition-shadow",children:(0,a.jsx)(i.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)(u.qE,{className:"h-16 w-16",children:[(0,a.jsx)(u.F$,{src:e.matched_user.avatar_url}),(0,a.jsx)(u.Q5,{children:e.matched_user.full_name.charAt(0).toUpperCase()})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.matched_user.full_name}),q(e.status)]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-1"}),e.matched_user.age,"岁"]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4 mr-1"}),e.matched_user.location]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-1"}),e.compatibility_score,"% 匹配度"]})]}),(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["匹配于 ",Y(e.matched_at),e.last_interaction&&(0,a.jsxs)("span",{className:"ml-4",children:["最后互动: ",Y(e.last_interaction)]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"text-right",children:(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["共 ",e.total_messages," 条消息"]})}),(0,a.jsxs)(c.z,{onClick:()=>L(e.id),disabled:"blocked"===e.status,children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"聊天"]})]})]})})},e.id))})]})})}},7702:function(e,t,s){"use strict";s.d(t,{F$:function(){return c},Q5:function(){return d},qE:function(){return i}});var a=s(7437),r=s(2265),n=s(1465),l=s(1628);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.fC,{ref:t,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r})});i.displayName=n.fC.displayName;let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.Ee,{ref:t,className:(0,l.cn)("aspect-square h-full w-full",s),...r})});c.displayName=n.Ee.displayName;let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.NY,{ref:t,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})});d.displayName=n.NY.displayName},708:function(e,t,s){"use strict";s.d(t,{C:function(){return i}});var a=s(7437);s(2265);var r=s(6061),n=s(1628);let l=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,n.cn)(l({variant:s}),t),...r})}},9598:function(e,t,s){"use strict";s.d(t,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return l},aY:function(){return u},ll:function(){return c}});var a=s(7437),r=s(2265),n=s(1628);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});l.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...r})});i.displayName="CardHeader";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});c.displayName="CardTitle";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});d.displayName="CardDescription";let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...r})});u.displayName="CardContent";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...r})});o.displayName="CardFooter"},5831:function(e,t,s){"use strict";s.d(t,{I:function(){return l}});var a=s(7437),r=s(2265),n=s(1628);let l=r.forwardRef((e,t)=>{let{className:s,type:r,label:l,error:i,icon:c,description:d,...u}=e;return(0,a.jsxs)("div",{className:"w-full space-y-1",children:[l&&(0,a.jsx)("label",{className:"block text-sm font-medium text-foreground",children:l}),(0,a.jsxs)("div",{className:"relative",children:[c&&(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:c}),(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background","file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50",c?"pl-10":"",i?"border-destructive focus-visible:ring-destructive/30":"",s),ref:t,...u})]}),d&&!i&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:d}),i&&(0,a.jsx)("p",{className:"text-xs text-destructive",children:i})]})});l.displayName="Input"},446:function(e,t,s){"use strict";s.d(t,{p:function(){return r}});var a=s(1271);let r=a.pm}},function(e){e.O(0,[216,689,744],function(){return e(e.s=1425)}),_N_E=e.O()}]);