(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[390],{1425:function(e,s,t){Promise.resolve().then(t.bind(t,4400))},4400:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return p}});var a=t(7437),r=t(2265),l=t(4033),i=t(4620),c=t(9598),n=t(3611),d=t(708),x=t(7702),m=t(446),u=t(3067),h=t(1827),o=t(7810),f=t(8203),v=t(6142),j=t(2882),g=t(1396),N=t.n(g),b=t(5831);function p(){let e=(0,l.useRouter)(),{user:s}=(0,i.a)(),{toast:t}=(0,m.p)(),[g,p]=(0,r.useState)([]),[y,w]=(0,r.useState)([]),[k,_]=(0,r.useState)(""),[C,z]=(0,r.useState)("all"),[Z,S]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!s){e.push("/auth/login");return}E()},[s]),(0,r.useEffect)(()=>{L()},[g,k,C]);let E=async()=>{try{S(!0);let e=await fetch("/api/user/matches");if(e.ok){let s=await e.json();p(s.matches)}}catch(e){t({title:"加载失败",description:"无法加载匹配历史",variant:"destructive"})}finally{S(!1)}},L=()=>{let e=g;switch(k&&(e=e.filter(e=>e.matched_user.full_name.toLowerCase().includes(k.toLowerCase())||e.matched_user.location.toLowerCase().includes(k.toLowerCase()))),C){case"active":e=e.filter(e=>"active"===e.status);break;case"inactive":e=e.filter(e=>"inactive"===e.status)}w(e)},A=s=>{e.push("/chat/".concat(s))},I=e=>{let s=new Date(e);return s.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})},D=e=>{switch(e){case"active":return(0,a.jsx)(d.C,{variant:"default",className:"bg-green-100 text-green-800",children:"活跃"});case"inactive":return(0,a.jsx)(d.C,{variant:"secondary",children:"不活跃"});case"blocked":return(0,a.jsx)(d.C,{variant:"destructive",children:"已屏蔽"});default:return(0,a.jsx)(d.C,{variant:"outline",children:"未知"})}};return Z?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"加载匹配历史中..."})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"匹配历史"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"查看您的所有匹配记录"})]}),(0,a.jsx)(N(),{href:"/dashboard",children:(0,a.jsxs)(n.z,{variant:"outline",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"返回仪表盘"]})})]}),(0,a.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)(b.I,{placeholder:"搜索匹配...",value:k,onChange:e=>_(e.target.value),className:"pl-10"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(n.z,{variant:"all"===C?"default":"outline",size:"sm",onClick:()=>z("all"),children:["全部 (",g.length,")"]}),(0,a.jsxs)(n.z,{variant:"active"===C?"default":"outline",size:"sm",onClick:()=>z("active"),children:["活跃 (",g.filter(e=>"active"===e.status).length,")"]}),(0,a.jsxs)(n.z,{variant:"inactive"===C?"default":"outline",size:"sm",onClick:()=>z("inactive"),children:["不活跃 (",g.filter(e=>"inactive"===e.status).length,")"]})]})]}),(0,a.jsx)("div",{className:"grid gap-4",children:0===y.length?(0,a.jsx)(c.Zb,{children:(0,a.jsxs)(c.aY,{className:"text-center py-12",children:[(0,a.jsx)(o.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"暂无匹配记录"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:k||"all"!==C?"没有找到符合条件的匹配":"开始匹配来发现新的朋友吧！"}),!k&&"all"===C&&(0,a.jsx)(n.z,{onClick:()=>e.push("/matching"),children:"开始匹配"})]})}):y.map(e=>(0,a.jsx)(c.Zb,{className:"hover:shadow-md transition-shadow",children:(0,a.jsx)(c.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)(x.Avatar,{className:"h-16 w-16",children:[(0,a.jsx)(x.AvatarImage,{src:e.matched_user.avatar_url}),(0,a.jsx)(x.AvatarFallback,{children:e.matched_user.full_name.charAt(0).toUpperCase()})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.matched_user.full_name}),D(e.status)]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-1"}),e.matched_user.age,"岁"]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4 mr-1"}),e.matched_user.location]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-1"}),e.compatibility_score,"% 匹配度"]})]}),(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["匹配于 ",I(e.matched_at),e.last_interaction&&(0,a.jsxs)("span",{className:"ml-4",children:["最后互动: ",I(e.last_interaction)]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"text-right",children:(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["共 ",e.total_messages," 条消息"]})}),(0,a.jsxs)(n.z,{onClick:()=>A(e.id),disabled:"blocked"===e.status,children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"聊天"]})]})]})})},e.id))})]})})}},5831:function(e,s,t){"use strict";t.d(s,{I:function(){return i}});var a=t(7437),r=t(2265),l=t(1628);let i=r.forwardRef((e,s)=>{let{className:t,type:r,label:i,error:c,icon:n,description:d,...x}=e;return(0,a.jsxs)("div",{className:"w-full space-y-1",children:[i&&(0,a.jsx)("label",{className:"block text-sm font-medium text-foreground",children:i}),(0,a.jsxs)("div",{className:"relative",children:[n&&(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:n}),(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background","file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50",n?"pl-10":"",c?"border-destructive focus-visible:ring-destructive/30":"",t),ref:s,...x})]}),d&&!c&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:d}),c&&(0,a.jsx)("p",{className:"text-xs text-destructive",children:c})]})});i.displayName="Input"}},function(e){e.O(0,[216,930,744],function(){return e(e.s=1425)}),_N_E=e.O()}]);