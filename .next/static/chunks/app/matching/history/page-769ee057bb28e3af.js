(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[390],{1425:function(e,s,a){Promise.resolve().then(a.bind(a,4400))},4400:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return b}});var t=a(7437),l=a(2265),r=a(4033),i=a(4620),c=a(9598),n=a(3611),d=a(708),x=a(7702),m=a(446),h=a(3067),u=a(1827),o=a(7810),j=a(8203),v=a(6142),f=a(2882),N=a(1396),g=a.n(N),y=a(5831);function b(){let e=(0,r.useRouter)(),{user:s}=(0,i.a)(),{toast:a}=(0,m.p)(),[N,b]=(0,l.useState)([]),[p,w]=(0,l.useState)([]),[k,_]=(0,l.useState)(""),[C,z]=(0,l.useState)("all"),[Z,E]=(0,l.useState)(!0);(0,l.useEffect)(()=>{if(!s){e.push("/auth/login");return}S()},[s]),(0,l.useEffect)(()=>{L()},[N,k,C]);let S=async()=>{try{E(!0);let e=await fetch("/api/user/matches");if(e.ok){let s=await e.json();b(s.matches)}}catch(e){a({title:"加载失败",description:"无法加载匹配历史",variant:"destructive"})}finally{E(!1)}},L=()=>{let e=N;switch(k&&(e=e.filter(e=>e.matched_user.full_name.toLowerCase().includes(k.toLowerCase())||e.matched_user.location.toLowerCase().includes(k.toLowerCase()))),C){case"active":e=e.filter(e=>"active"===e.status);break;case"inactive":e=e.filter(e=>"inactive"===e.status)}w(e)},D=s=>{e.push("/chat/".concat(s))},O=e=>{let s=new Date(e);return s.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})},Y=e=>{switch(e){case"active":return(0,t.jsx)(d.C,{variant:"default",className:"bg-green-100 text-green-800",children:"活跃"});case"inactive":return(0,t.jsx)(d.C,{variant:"secondary",children:"不活跃"});case"blocked":return(0,t.jsx)(d.C,{variant:"destructive",children:"已屏蔽"});default:return(0,t.jsx)(d.C,{variant:"outline",children:"未知"})}};return Z?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"加载匹配历史中..."})]})}):(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"匹配历史"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"查看您的所有匹配记录"})]}),(0,t.jsx)(g(),{href:"/dashboard",children:(0,t.jsxs)(n.z,{variant:"outline",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"返回仪表盘"]})})]}),(0,t.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(u.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,t.jsx)(y.I,{placeholder:"搜索匹配...",value:k,onChange:e=>_(e.target.value),className:"pl-10"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)(n.z,{variant:"all"===C?"default":"outline",size:"sm",onClick:()=>z("all"),children:["全部 (",N.length,")"]}),(0,t.jsxs)(n.z,{variant:"active"===C?"default":"outline",size:"sm",onClick:()=>z("active"),children:["活跃 (",N.filter(e=>"active"===e.status).length,")"]}),(0,t.jsxs)(n.z,{variant:"inactive"===C?"default":"outline",size:"sm",onClick:()=>z("inactive"),children:["不活跃 (",N.filter(e=>"inactive"===e.status).length,")"]})]})]}),(0,t.jsx)("div",{className:"grid gap-4",children:0===p.length?(0,t.jsx)(c.Zb,{children:(0,t.jsxs)(c.aY,{className:"text-center py-12",children:[(0,t.jsx)(o.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"暂无匹配记录"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:k||"all"!==C?"没有找到符合条件的匹配":"开始匹配来发现新的朋友吧！"}),!k&&"all"===C&&(0,t.jsx)(n.z,{onClick:()=>e.push("/matching"),children:"开始匹配"})]})}):p.map(e=>(0,t.jsx)(c.Zb,{className:"hover:shadow-md transition-shadow",children:(0,t.jsx)(c.aY,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)(x.qE,{className:"h-16 w-16",children:[(0,t.jsx)(x.F$,{src:e.matched_user.avatar_url}),(0,t.jsx)(x.Q5,{children:e.matched_user.full_name.charAt(0).toUpperCase()})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.matched_user.full_name}),Y(e.status)]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(j.Z,{className:"h-4 w-4 mr-1"}),e.matched_user.age,"岁"]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(v.Z,{className:"h-4 w-4 mr-1"}),e.matched_user.location]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(o.Z,{className:"h-4 w-4 mr-1"}),e.compatibility_score,"% 匹配度"]})]}),(0,t.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["匹配于 ",O(e.matched_at),e.last_interaction&&(0,t.jsxs)("span",{className:"ml-4",children:["最后互动: ",O(e.last_interaction)]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["共 ",e.total_messages," 条消息"]})}),(0,t.jsxs)(n.z,{onClick:()=>D(e.id),disabled:"blocked"===e.status,children:[(0,t.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"聊天"]})]})]})})},e.id))})]})})}}},function(e){e.O(0,[216,76,744],function(){return e(e.s=1425)}),_N_E=e.O()}]);