(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[159],{5090:function(e,r,s){Promise.resolve().then(s.bind(s,9649))},9649:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return w}});var t=s(7437),a=s(2265),i=s(4033),l=s(1865),n=s(8110),d=s(2160),c=s(3611),o=s(5831),m=s(9598),u=s(2147),f=s(4620),x=s(446),h=s(3067),p=s(7972),b=s(8203),g=s(6142),j=s(2295),N=s(1396),v=s.n(N);let y=d.Ry({username:d.Z_().min(3,"用户名至少3个字符"),bio:d.Z_().max(500,"个人简介不能超过500字符"),age:d.Rx().min(18,"年龄必须至少18岁").max(100,"年龄不能超过100岁"),location:d.Z_().min(2,"请输入有效的位置")});function w(){let[e,r]=(0,a.useState)(!1),[s,d]=(0,a.useState)(null),N=(0,i.useRouter)(),{user:w}=(0,f.a)(),{toast:k}=(0,x.p)(),S=(0,l.cI)({resolver:(0,n.F)(y)});(0,a.useEffect)(()=>{if(!w){N.push("/auth/login");return}Z()},[w,N]);let Z=async()=>{try{let e=await fetch("/api/user/profile");if(e.ok){let r=await e.json();d(r.profile),S.reset({username:r.profile.username||"",bio:r.profile.bio||"",age:r.profile.age||18,location:r.profile.location||""})}}catch(e){k({title:"加载失败",description:"无法加载个人资料",variant:"destructive"})}},R=async e=>{r(!0);try{let r=await fetch("/api/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(r.ok)k({title:"更新成功",description:"您的个人资料已成功更新"}),N.push("/dashboard");else throw Error("更新失败")}catch(e){k({title:"更新失败",description:"请稍后重试",variant:"destructive"})}finally{r(!1)}};return w&&s?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,t.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"编辑个人资料"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"更新您的个人信息和偏好设置"})]}),(0,t.jsx)(v(),{href:"/dashboard",children:(0,t.jsxs)(c.z,{variant:"outline",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"返回仪表盘"]})})]}),(0,t.jsxs)(m.Zb,{children:[(0,t.jsxs)(m.Ol,{children:[(0,t.jsx)(m.ll,{children:"基本信息"}),(0,t.jsx)(m.SZ,{children:"更新您的基本个人信息"})]}),(0,t.jsx)(m.aY,{children:(0,t.jsxs)("form",{onSubmit:S.handleSubmit(R),className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"用户名"}),(0,t.jsx)(o.I,{...S.register("username"),placeholder:"输入用户名",icon:(0,t.jsx)(p.Z,{className:"h-4 w-4"})}),S.formState.errors.username&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:S.formState.errors.username.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"个人简介"}),(0,t.jsx)(u.g,{...S.register("bio"),placeholder:"简单介绍一下自己...",rows:4}),S.formState.errors.bio&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:S.formState.errors.bio.message})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"年龄"}),(0,t.jsx)(o.I,{...S.register("age",{valueAsNumber:!0}),type:"number",placeholder:"年龄",icon:(0,t.jsx)(b.Z,{className:"h-4 w-4"})}),S.formState.errors.age&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:S.formState.errors.age.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"位置"}),(0,t.jsx)(o.I,{...S.register("location"),placeholder:"城市，国家",icon:(0,t.jsx)(g.Z,{className:"h-4 w-4"})}),S.formState.errors.location&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:S.formState.errors.location.message})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-4 pt-4",children:[(0,t.jsx)(v(),{href:"/dashboard",children:(0,t.jsx)(c.z,{type:"button",variant:"outline",children:"取消"})}),(0,t.jsxs)(c.z,{type:"submit",disabled:e,children:[(0,t.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),e?"保存中...":"保存更改"]})]})]})})]})]})}):(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"加载个人资料中..."})]})})}},9598:function(e,r,s){"use strict";s.d(r,{Ol:function(){return n},SZ:function(){return c},Zb:function(){return l},aY:function(){return o},ll:function(){return d}});var t=s(7437),a=s(2265),i=s(1628);let l=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});l.displayName="Card";let n=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",s),...a})});n.displayName="CardHeader";let d=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("h3",{ref:r,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})});d.displayName="CardTitle";let c=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("p",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",s),...a})});c.displayName="CardDescription";let o=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",s),...a})});o.displayName="CardContent";let m=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",s),...a})});m.displayName="CardFooter"},5831:function(e,r,s){"use strict";s.d(r,{I:function(){return l}});var t=s(7437),a=s(2265),i=s(1628);let l=a.forwardRef((e,r)=>{let{className:s,type:a,label:l,error:n,icon:d,description:c,...o}=e;return(0,t.jsxs)("div",{className:"w-full space-y-1",children:[l&&(0,t.jsx)("label",{className:"block text-sm font-medium text-foreground",children:l}),(0,t.jsxs)("div",{className:"relative",children:[d&&(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:d}),(0,t.jsx)("input",{type:a,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background","file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50",d?"pl-10":"",n?"border-destructive focus-visible:ring-destructive/30":"",s),ref:r,...o})]}),c&&!n&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:c}),n&&(0,t.jsx)("p",{className:"text-xs text-destructive",children:n})]})});l.displayName="Input"},2147:function(e,r,s){"use strict";s.d(r,{g:function(){return l}});var t=s(7437),a=s(2265),i=s(1628);let l=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:r,...a})});l.displayName="Textarea"},446:function(e,r,s){"use strict";s.d(r,{p:function(){return a}});var t=s(1271);let a=t.pm}},function(e){e.O(0,[216,689,744],function(){return e(e.s=5090)}),_N_E=e.O()}]);