(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[159],{5090:function(e,s,r){Promise.resolve().then(r.bind(r,9649))},9649:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return w}});var t=r(7437),a=r(2265),i=r(4033),l=r(1865),n=r(8110),c=r(2160),o=r(3611),d=r(5831),m=r(9598),x=r(2147),u=r(4620),h=r(446),f=r(3067),j=r(7972),b=r(8203),p=r(6142),g=r(2295),N=r(1396),y=r.n(N);let v=c.Ry({username:c.Z_().min(3,"用户名至少3个字符"),bio:c.Z_().max(500,"个人简介不能超过500字符"),age:c.Rx().min(18,"年龄必须至少18岁").max(100,"年龄不能超过100岁"),location:c.Z_().min(2,"请输入有效的位置")});function w(){let[e,s]=(0,a.useState)(!1),[r,c]=(0,a.useState)(null),N=(0,i.useRouter)(),{user:w}=(0,u.a)(),{toast:S}=(0,h.p)(),k=(0,l.cI)({resolver:(0,n.F)(v)});(0,a.useEffect)(()=>{if(!w){N.push("/auth/login");return}Z()},[w,N]);let Z=async()=>{try{let e=await fetch("/api/user/profile");if(e.ok){let s=await e.json();c(s.profile),k.reset({username:s.profile.username||"",bio:s.profile.bio||"",age:s.profile.age||18,location:s.profile.location||""})}}catch(e){S({title:"加载失败",description:"无法加载个人资料",variant:"destructive"})}},_=async e=>{s(!0);try{let s=await fetch("/api/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(s.ok)S({title:"更新成功",description:"您的个人资料已成功更新"}),N.push("/dashboard");else throw Error("更新失败")}catch(e){S({title:"更新失败",description:"请稍后重试",variant:"destructive"})}finally{s(!1)}};return w&&r?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,t.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"编辑个人资料"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"更新您的个人信息和偏好设置"})]}),(0,t.jsx)(y(),{href:"/dashboard",children:(0,t.jsxs)(o.z,{variant:"outline",children:[(0,t.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"返回仪表盘"]})})]}),(0,t.jsxs)(m.Zb,{children:[(0,t.jsxs)(m.Ol,{children:[(0,t.jsx)(m.ll,{children:"基本信息"}),(0,t.jsx)(m.SZ,{children:"更新您的基本个人信息"})]}),(0,t.jsx)(m.aY,{children:(0,t.jsxs)("form",{onSubmit:k.handleSubmit(_),className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"用户名"}),(0,t.jsx)(d.I,{...k.register("username"),placeholder:"输入用户名",icon:(0,t.jsx)(j.Z,{className:"h-4 w-4"})}),k.formState.errors.username&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:k.formState.errors.username.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"个人简介"}),(0,t.jsx)(x.g,{...k.register("bio"),placeholder:"简单介绍一下自己...",rows:4}),k.formState.errors.bio&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:k.formState.errors.bio.message})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"年龄"}),(0,t.jsx)(d.I,{...k.register("age",{valueAsNumber:!0}),type:"number",placeholder:"年龄",icon:(0,t.jsx)(b.Z,{className:"h-4 w-4"})}),k.formState.errors.age&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:k.formState.errors.age.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"位置"}),(0,t.jsx)(d.I,{...k.register("location"),placeholder:"城市，国家",icon:(0,t.jsx)(p.Z,{className:"h-4 w-4"})}),k.formState.errors.location&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:k.formState.errors.location.message})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-4 pt-4",children:[(0,t.jsx)(y(),{href:"/dashboard",children:(0,t.jsx)(o.z,{type:"button",variant:"outline",children:"取消"})}),(0,t.jsxs)(o.z,{type:"submit",disabled:e,children:[(0,t.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),e?"保存中...":"保存更改"]})]})]})})]})]})}):(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"加载个人资料中..."})]})})}},2147:function(e,s,r){"use strict";r.d(s,{g:function(){return l}});var t=r(7437),a=r(2265),i=r(1628);let l=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:s,...a})});l.displayName="Textarea"}},function(e){e.O(0,[216,58,744],function(){return e(e.s=5090)}),_N_E=e.O()}]);