(()=>{var e={};e.id=4508,e.ids=[4508],e.modules={30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},39142:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>_,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>d,serverHooks:()=>b,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>w});var s={};r.r(s),r.d(s,{GET:()=>p,POST:()=>h});var a=r(10884),i=r(16132),n=r(21040),o=r(95798),c=r(16163);let u=(0,c.eI)("https://bamratexknmqvdbalzen.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);class l{static getInstance(){return l.instance||(l.instance=new l),l.instance}async loadUserProfiles(){let{data:e,error:t}=await u.from("profiles").select("*");t||(this.userProfiles.clear(),e?.forEach(e=>{this.userProfiles.set(e.id,e)}))}async findMatches(e,t=10){let r=this.userProfiles.get(e);if(!r)throw Error("User profile not found");let s=[];for(let[t,a]of Array.from(this.userProfiles.entries())){if(t===e)continue;let i=this.calculateCompatibilityScore(r,a),n=this.generateMatchReasons(r,a),o=this.calculateCompatibilityFactors(r,a);s.push({user:a,score:i,reasons:n,compatibility_factors:o})}return s.sort((e,t)=>t.score-e.score).slice(0,t)}calculateCompatibilityScore(e,t){let r=this.calculateCompatibilityFactors(e,t),s={interests:.25,personality:.3,timezone:.15,industry:.1,communication:.2};return Object.entries(r).reduce((e,[t,r])=>e+r*s[t],0)}calculateCompatibilityFactors(e,t){return{interests:this.calculateInterestsCompatibility(e,t),personality:this.calculatePersonalityCompatibility(e,t),timezone:this.calculateTimezoneCompatibility(e,t),industry:this.calculateIndustryCompatibility(e,t),communication:this.calculateCommunicationCompatibility(e,t)}}calculateInterestsCompatibility(e,t){let r=new Set(e.interests),s=new Set(t.interests),a=new Set(e.hobbies),i=new Set(t.hobbies),n=new Set([...Array.from(r),...Array.from(a)]),o=new Set([...Array.from(s),...Array.from(i)]),c=new Set([...Array.from(n)].filter(e=>o.has(e))),u=new Set([...Array.from(n),...Array.from(o)]);return u.size>0?c.size/u.size:0}calculatePersonalityCompatibility(e,t){let r=e.personality_traits||{},s=t.personality_traits||{},a=Object.keys(r).filter(e=>s.hasOwnProperty(e));if(0===a.length)return .5;let i=0;for(let e of a){let t=r[e],a=s[e],n=1-Math.abs(t-a)/Math.max(t,a,1);i+=n}return i/a.length}calculateTimezoneCompatibility(e,t){let r=parseInt(e.timezone.replace("+","")),s=parseInt(t.timezone.replace("+",""));return Math.max(0,1-Math.abs(r-s)/12)}calculateIndustryCompatibility(e,t){if(!e.industry||!t.industry)return .5;let r={tech:["software","technology","it","engineering"],finance:["finance","banking","investment","accounting"],healthcare:["healthcare","medical","nursing","pharmacy"],education:["education","teaching","academic","research"],creative:["design","art","marketing","media","entertainment"]},s=e=>{let t=e.toLowerCase();for(let[e,s]of Object.entries(r))if(s.some(e=>t.includes(e)))return e;return"other"},a=s(e.industry),i=s(t.industry);return a===i?1:.3}calculateCommunicationCompatibility(e,t){let r=e.communication_style||"casual",s=t.communication_style||"casual";return r===s?1:({casual:{casual:1,friendly:.8,professional:.4,formal:.2},friendly:{casual:.8,friendly:1,professional:.6,formal:.4},professional:{casual:.4,friendly:.6,professional:1,formal:.8},formal:{casual:.2,friendly:.4,professional:.8,formal:1}})[r]?.[s]||.5}generateMatchReasons(e,t){let r=[],s=this.calculateCompatibilityFactors(e,t);s.interests>.7&&r.push("You share many common interests and hobbies"),s.personality>.8&&r.push("Your personalities are highly compatible"),s.timezone>.9&&r.push("You're in the same timezone, making communication easier"),s.industry>.8&&r.push("You work in similar industries"),s.communication>.8&&r.push("You have compatible communication styles");let a=e.interests.filter(e=>t.interests.includes(e)).slice(0,2);return a.length>0&&r.push(`You both enjoy ${a.join(" and ")}`),r.length>0?r:["You might have interesting conversations together"]}async saveMatch(e,t,r,s){await u.from("match_history").insert({user_id:e,match_id:t,score:r,reason:s.join("; ")})}constructor(){this.userProfiles=new Map}}let m=(0,c.eI)("https://bamratexknmqvdbalzen.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function p(e){try{let{searchParams:t}=new URL(e.url),r=t.get("userId"),s=parseInt(t.get("limit")||"10");if(!r)return o.Z.json({error:"User ID is required"},{status:400});let a=l.getInstance();await a.loadUserProfiles();let i=await a.findMatches(r,s);for(let e of i.slice(0,5))await a.saveMatch(r,e.user.id,e.score,e.reasons);return o.Z.json({matches:i,total:i.length})}catch(e){return o.Z.json({error:"Failed to find matches"},{status:500})}}async function h(e){try{let{userId:t,matchedUserId:r,action:s}=await e.json();if(!t||!r||!s)return o.Z.json({error:"User ID, matched user ID, and action are required"},{status:400});switch(s){case"like":let{data:a}=await m.from("matches").select("*").or(`user1_id.eq.${r},user2_id.eq.${r}`).or(`user1_id.eq.${t},user2_id.eq.${t}`).single();if(a)return await m.from("matches").insert({user1_id:t,user2_id:r,status:"accepted"}),o.Z.json({message:"It's a match!",isMatch:!0});return await m.from("matches").insert({user1_id:t,user2_id:r,status:"pending"}),o.Z.json({message:"Like recorded",isMatch:!1});case"pass":return await m.from("matches").insert({user1_id:t,user2_id:r,status:"rejected"}),o.Z.json({message:"Pass recorded"});default:return o.Z.json({error:"Invalid action"},{status:400})}}catch(e){return o.Z.json({error:"Failed to process match action"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/match/route",pathname:"/api/match",filename:"route",bundlePath:"app/api/match/route"},resolvedPagePath:"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/api/match/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:b,headerHooks:g,staticGenerationBailout:w}=d,_="/api/match/route";function v(){return(0,n.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:y})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[3271,1945,8107],()=>r(39142));module.exports=s})();