(()=>{var e={};e.id=1258,e.ids=[1258],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},25380:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>d,routeModule:()=>u,tree:()=>o});var a=s(67096),r=s(16132),i=s(37284),n=s.n(i),c=s(32564),l={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>c[e]);s.d(t,l);let o=["",{children:["dashboard",{children:["notifications",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,34589)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/dashboard/notifications/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,53683)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,44775)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/layout.tsx"],error:[()=>Promise.resolve().then(s.bind(s,38196)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/error.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,44293)),"/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/not-found.tsx"]}],d=["/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/dashboard/notifications/page.tsx"],m="/dashboard/notifications/page",x={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/notifications/page",pathname:"/dashboard/notifications",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},31381:(e,t,s)=>{Promise.resolve().then(s.bind(s,261))},4578:(e,t,s)=>{Promise.resolve().then(s.bind(s,39195)),Promise.resolve().then(s.t.bind(s,67490,23))},261:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>j});var a=s(53854),r=s(34218),i=s(51018),n=s(86665),c=s(63165),l=s(7857),o=s(26115),d=s(39195),m=s(31974),x=s(67510),u=s(49425),h=s(89471),p=s(66802),f=s(2882),v=s(75548),g=s.n(v);function j(){let e=(0,i.useRouter)(),{user:t}=(0,n.a)(),{toast:s}=(0,m.p)(),[v,j]=(0,r.useState)([]),[y,b]=(0,r.useState)(!0),[N,w]=(0,r.useState)(0);(0,r.useEffect)(()=>{if(!t){e.push("/auth/login");return}_()},[t]);let _=async()=>{try{b(!0);let e=await fetch("/api/user/notifications");if(e.ok){let t=await e.json();j(t.notifications),w(t.notifications.filter(e=>!e.is_read).length)}}catch(e){s({title:"加载失败",description:"无法加载通知",variant:"destructive"})}finally{b(!1)}},k=async e=>{try{let t=await fetch(`/api/user/notifications/${e}/read`,{method:"PUT"});t.ok&&(j(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t)),w(e=>Math.max(0,e-1)))}catch(e){s({title:"操作失败",description:"无法标记为已读",variant:"destructive"})}},Z=async()=>{try{let e=await fetch("/api/user/notifications/read-all",{method:"PUT"});e.ok&&(j(e=>e.map(e=>({...e,is_read:!0}))),w(0),s({title:"已全部标记为已读"}))}catch(e){s({title:"操作失败",description:"无法标记全部为已读",variant:"destructive"})}},P=t=>{t.is_read||k(t.id),t.action_url&&e.push(t.action_url)},q=e=>{switch(e){case"match":return a.jsx(x.Z,{className:"h-5 w-5 text-red-500"});case"message":return a.jsx(u.Z,{className:"h-5 w-5 text-blue-500"});case"payment":return a.jsx(h.Z,{className:"h-5 w-5 text-green-500"});default:return a.jsx(h.Z,{className:"h-5 w-5 text-gray-500"})}},C=e=>{switch(e){case"match":return a.jsx(o.C,{variant:"destructive",className:"bg-red-100 text-red-800",children:"匹配"});case"message":return a.jsx(o.C,{variant:"default",className:"bg-blue-100 text-blue-800",children:"消息"});case"payment":return a.jsx(o.C,{variant:"default",className:"bg-green-100 text-green-800",children:"支付"});default:return a.jsx(o.C,{variant:"secondary",children:"系统"})}},M=e=>{let t=new Date(e),s=new Date,a=(s.getTime()-t.getTime())/36e5;return a<1?"刚刚":a<24?`${Math.floor(a)}小时前`:a<168?`${Math.floor(a/24)}天前`:t.toLocaleDateString("zh-CN")};return y?a.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"加载通知中..."})]})}):a.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"通知中心"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"查看您的所有通知和消息"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[N>0&&(0,a.jsxs)(l.z,{variant:"outline",onClick:Z,children:[a.jsx(p.Z,{className:"h-4 w-4 mr-2"}),"全部已读"]}),a.jsx(g(),{href:"/dashboard",children:(0,a.jsxs)(l.z,{variant:"outline",children:[a.jsx(f.Z,{className:"h-4 w-4 mr-2"}),"返回仪表盘"]})})]})]}),a.jsx("div",{className:"space-y-4",children:0===v.length?a.jsx(c.Zb,{children:(0,a.jsxs)(c.aY,{className:"text-center py-12",children:[a.jsx(h.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"暂无通知"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"当有新消息、匹配或其他重要事件时，您会在这里看到通知"})]})}):v.map(e=>a.jsx(c.Zb,{className:`cursor-pointer transition-all hover:shadow-md ${e.is_read?"":"border-blue-200 bg-blue-50 dark:bg-blue-900/20"}`,onClick:()=>P(e),children:a.jsx(c.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:"flex-shrink-0 mt-1",children:q(e.type)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),C(e.type),!e.is_read&&a.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:"text-sm text-gray-500",children:M(e.created_at)}),!e.is_read&&a.jsx(l.z,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),k(e.id)},children:a.jsx(p.Z,{className:"h-4 w-4"})})]})]}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:e.message}),e.sender&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,a.jsxs)(d.Avatar,{className:"h-6 w-6",children:[a.jsx(d.AvatarImage,{src:e.sender.avatar_url}),a.jsx(d.AvatarFallback,{children:e.sender.name.charAt(0).toUpperCase()})]}),a.jsx("span",{className:"text-sm text-gray-500",children:e.sender.name})]})]})]})})},e.id))})]})})}},39195:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Avatar:()=>c,AvatarFallback:()=>o,AvatarImage:()=>l});var a=s(53854),r=s(34218),i=s(49198),n=s(56370);let c=r.forwardRef(({className:e,...t},s)=>a.jsx(i.fC,{ref:s,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));c.displayName=i.fC.displayName;let l=r.forwardRef(({className:e,...t},s)=>a.jsx(i.Ee,{ref:s,className:(0,n.cn)("aspect-square h-full w-full",e),...t}));l.displayName=i.Ee.displayName;let o=r.forwardRef(({className:e,...t},s)=>a.jsx(i.NY,{ref:s,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));o.displayName=i.NY.displayName},31974:(e,t,s)=>{"use strict";s.d(t,{p:()=>r});var a=s(70664);let r=a.pm},2882:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var a=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},89471:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var a=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a.Z)("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]])},66802:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var a=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a.Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},67510:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var a=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a.Z)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]])},49425:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var a=s(23708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a.Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},53683:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>q});var a=s(4656),r=s(74280),i=s(24596),n=s(41412);async function c(){try{let e=(0,i.cookies)(),t=(0,r.createServerClient)("https://bamratexknmqvdbalzen.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJhbXJhdGV4a25tcXZkYmFsemVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MTM4NzEsImV4cCI6MjA2ODA4OTg3MX0.yYa98ioJLLouUgHWITGb7U_VjNCTUuM-5NcraM7f3zA",{cookies:{get:t=>e.get(t)?.value,set(t,s,a){e.set({name:t,value:s,...a})},remove(t,s){e.set({name:t,value:"",...s})}}}),{data:{user:s},error:a}=await t.auth.getUser();if(a||!s)return null;return s}catch(e){return null}}var l=s(24353),o=s.n(l),d=s(43935),m=s(4850),x=s(95153);let u=(0,x.createProxy)(String.raw`/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/components/ui/avatar.tsx`),{__esModule:h,$$typeof:p}=u;u.default;let f=(0,x.createProxy)(String.raw`/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/components/ui/avatar.tsx#Avatar`),v=(0,x.createProxy)(String.raw`/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/components/ui/avatar.tsx#AvatarImage`),g=(0,x.createProxy)(String.raw`/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/components/ui/avatar.tsx#AvatarFallback`);var j=s(95695),y=s(28543),b=s(53111),N=s(34492),w=s(57505),_=s(83515),k=s(19549);let Z=[{name:"Dashboard",href:"/dashboard",icon:j.Z},{name:"Chat",href:"/chat",icon:y.Z},{name:"Matching",href:"/matching",icon:b.Z},{name:"Recharge",href:"/payment/recharge",icon:N.Z},{name:"Settings",href:"/dashboard/settings",icon:w.Z}],P=({user:e})=>{let t=(0,n.usePathname)(),s=async()=>{window.location.href="/auth/login"};return(0,a.jsxs)("div",{className:"flex flex-col w-64 bg-background border-r",children:[a.jsx("div",{className:"flex items-center justify-center h-16 border-b px-4",children:a.jsx("h1",{className:"text-xl font-bold text-primary",children:"PersonaLink"})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[a.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2",children:Z.map(e=>{let s=t===e.href;return(0,a.jsxs)(o(),{href:e.href,className:(0,d.cn)("flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors",s?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[a.jsx(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,a.jsxs)("div",{className:"border-t p-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsxs)(f,{className:"h-10 w-10",children:[a.jsx(v,{src:e?.user_metadata?.avatar_url}),a.jsx(g,{children:e?.email?.charAt(0).toUpperCase()||"U"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:e?.user_metadata?.full_name||e?.email}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground truncate",children:[e?.user_metadata?.credits||0," credits"]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(m.z,{variant:"ghost",size:"sm",className:"w-full justify-start",asChild:!0,children:(0,a.jsxs)(o(),{href:"/dashboard/notifications",children:[a.jsx(_.Z,{className:"mr-2 h-4 w-4"}),"Notifications"]})}),(0,a.jsxs)(m.z,{variant:"ghost",size:"sm",className:"w-full justify-start text-destructive hover:text-destructive",onClick:s,children:[a.jsx(k.Z,{className:"mr-2 h-4 w-4"}),"Sign Out"]})]})]})]})]})};async function q({children:e}){let t=await c();return t||(0,n.redirect)("/auth/login"),(0,a.jsxs)("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[a.jsx(P,{user:t}),a.jsx("main",{className:"flex-1 overflow-y-auto",children:a.jsx("div",{className:"p-6",children:e})})]})}},34589:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>i,default:()=>l});var a=s(95153);let r=(0,a.createProxy)(String.raw`/Users/mac-guest1/Downloads/Git/mvp_projects/mvp_1/app/dashboard/notifications/page.tsx`),{__esModule:i,$$typeof:n}=r,c=r.default,l=c}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[3271,1945,5649,782,5640,4049],()=>s(25380));module.exports=a})();